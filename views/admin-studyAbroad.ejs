<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!--<![endif]-->

<head>
    <!-- Basic Page Needs -->
    <meta charset="utf-8">
    <title>IIMF - Admin Dashboard</title>

    <meta name="author" content="trivlogic.com">

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- Theme Style -->
    <link rel="stylesheet" type="text/css" href="admin-css/animate.min.css">
    <link rel="stylesheet" type="text/css" href="admin-css/animation.css">
    <link rel="stylesheet" type="text/css" href="admin-css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="admin-css/bootstrap-select.min.css">
    <link rel="stylesheet" type="text/css" href="admin-css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Font -->
    <link rel="stylesheet" href="admin-font/fonts.css">

    <!-- Icon -->
    <link rel="stylesheet" href="admin-icon/style.css">

    <!-- Favicon and Touch Icons  -->
    <link rel="shortcut icon" href="/images/iimf/logo.png">
    <link rel="apple-touch-icon-precomposed" href="/images/iimf/logo.png">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9MTVEJ4YNF"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9MTVEJ4YNF');
</script>

</head>

<body>

    <!-- #wrapper -->
    <div id="wrapper">
        <!-- #page -->
        <div id="page" class="">
            <!-- layout-wrap -->
            <div class="layout-wrap">
            
                <!-- section-menu-left -->
                <div class="section-menu-left">
                    <div class="box-logo">
                        <a href="/dashboard" id="site-logo-inner">
                            <img style="width:60px;" id="logo_header" alt="Maxtron" src="/images/iimf/logo.png"
                                data-light="/images/iimf/logo.png" data-dark="/images/iimf/logo.png">
                        </a>
                        <div class="button-show-hide">
                            <i class="icon-chevron-left"></i>
                        </div>
                    </div>
                    <div class="section-menu-left-wrap">
                        <div class="center">
                            <div class="center-item">
                                <ul class="">
                                    <li class="menu-item">
                                        <a href="/dashboard" class="">
                                            <div class="icon">
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                    xmlns="http://www.w3.org/2000/svg">
                                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                                        d="M12.2652 3.57566C12.1187 3.42921 11.8813 3.42921 11.7348 3.57566L5.25 10.0605V19.8748C5.25 20.0819 5.41789 20.2498 5.625 20.2498H9V16.1248C9 15.0893 9.83947 14.2498 10.875 14.2498H13.125C14.1605 14.2498 15 15.0893 15 16.1248V20.2498H18.375C18.5821 20.2498 18.75 20.0819 18.75 19.8748V10.0605L12.2652 3.57566ZM20.25 11.5605L21.2197 12.5302C21.5126 12.8231 21.9874 12.8231 22.2803 12.5302C22.5732 12.2373 22.5732 11.7624 22.2803 11.4695L13.3258 2.51499C12.5936 1.78276 11.4064 1.78276 10.6742 2.515L1.71967 11.4695C1.42678 11.7624 1.42678 12.2373 1.71967 12.5302C2.01256 12.8231 2.48744 12.8231 2.78033 12.5302L3.75 11.5605V19.8748C3.75 20.9104 4.58947 21.7498 5.625 21.7498H18.375C19.4105 21.7498 20.25 20.9104 20.25 19.8748V11.5605ZM13.5 20.2498H10.5V16.1248C10.5 15.9177 10.6679 15.7498 10.875 15.7498H13.125C13.3321 15.7498 13.5 15.9177 13.5 16.1248V20.2498Z"
                                                        fill="#111111" />
                                                </svg>
                                            </div>
                                            <div class="text">Course Management</div>
                                        </a>
                                    </li>
                                    <li class="menu-item">
                                        <a href="/admin-gallery" class="menu-item-button">
                                            <div class="icon"><i class="icon-file-plus"></i></div>
                                            <div class="text">Gallery Management</div>
                                        </a>                                   
                                    </li>
                                    <li class="menu-item">
                                        <a href="/admin-assesment" class="menu-item-button">
                                            <div class="icon"><i class="icon-layers"></i></div>
                                            <div class="text">Assesment Management</div>
                                        </a>                                   
                                    </li>
                                    <li class="menu-item active">
                                        <a href="/admin-studyAbroad" class="menu-item-button">
                                            <div class="icon"><i class="fa fa-users"></i></div>
                                            <div class="text">StudyAbroad Management</div>
                                        </a>
                                    </li>
                                    <li class="menu-item">
                                        <a href="/admin-events" class="menu-item-button">
                                            <div class="icon"><i class="fa fa-users"></i></div>
                                            <div class="text">Events Management</div>
                                        </a>
                                    </li>
                                    <li class="menu-item ">
                                        <a href="/admin-testimonials" class="menu-item-button">
                                            <div class="icon"><i class="fa fa-star-o"></i></div>
                                            <div class="text">Testimonials Management</div>
                                        </a>
                                    </li>
                                    <li class="menu-item">
                                        <a href="/admin-blogs" class="menu-item-button">
                                            <div class="icon"><i class="fa fa-star-o"></i></div>
                                            <div class="text">Blogs Management</div>
                                        </a>
                                       
                                    </li>
                                    <li class="menu-item">
                                        <a href="/admin-careers" class="menu-item-button">
                                            <div class="icon"><i class="fa fa-star-o"></i></div>
                                            <div class="text">Career Management</div>
                                        </a>
                                       
                                    </li>
                                    <li class="menu-item">
                                        <a href="/admin-users" class="menu-item-button">
                                            <div class="icon"><i class="fa fa-star-o"></i></div>
                                            <div class="text">User Management</div>
                                        </a>
                                       
                                    </li>
                                    <li class="menu-item">
                                        <a href="/admin-forms" class="menu-item-button">
                                            <div class="icon"><i class="fa fa-star-o"></i></div>
                                            <div class="text">Contact Submissions</div>
                                        </a>
                                       
                                    </li>
                                    <li class="menu-item">
                                        <a href="/logout" class="">
                                            <div class="icon">
                                                <svg width="24" height="22" viewBox="0 0 20 20" fill="none"
                                                    xmlns="http://www.w3.org/2000/svg">
                                                    <path
                                                        d="M8.125 18.6875C8.125 18.903 8.0394 19.1097 7.88702 19.262C7.73465 19.4144 7.52799 19.5 7.3125 19.5H1.625C1.19402 19.5 0.780698 19.3288 0.475951 19.024C0.171205 18.7193 0 18.306 0 17.875V1.625C0 1.19402 0.171205 0.780698 0.475951 0.475951C0.780698 0.171205 1.19402 0 1.625 0H7.3125C7.52799 0 7.73465 0.0856026 7.88702 0.237976C8.0394 0.390349 8.125 0.597012 8.125 0.8125C8.125 1.02799 8.0394 1.23465 7.88702 1.38702C7.73465 1.5394 7.52799 1.625 7.3125 1.625H1.625V17.875H7.3125C7.52799 17.875 7.73465 17.9606 7.88702 18.113C8.0394 18.2653 8.125 18.472 8.125 18.6875ZM19.2623 9.17516L15.1998 5.11266C15.0474 4.9602 14.8406 4.87455 14.625 4.87455C14.4094 4.87455 14.2026 4.9602 14.0502 5.11266C13.8977 5.26511 13.812 5.47189 13.812 5.6875C13.812 5.90311 13.8977 6.10989 14.0502 6.26234L16.7263 8.9375H7.3125C7.09701 8.9375 6.89035 9.0231 6.73798 9.17548C6.5856 9.32785 6.5 9.53451 6.5 9.75C6.5 9.96549 6.5856 10.1722 6.73798 10.3245C6.89035 10.4769 7.09701 10.5625 7.3125 10.5625H16.7263L14.0502 13.2377C13.8977 13.3901 13.812 13.5969 13.812 13.8125C13.812 14.0281 13.8977 14.2349 14.0502 14.3873C14.2026 14.5398 14.4094 14.6255 14.625 14.6255C14.8406 14.6255 15.0474 14.5398 15.1998 14.3873L19.2623 10.3248C19.3379 10.2494 19.3978 10.1598 19.4387 10.0611C19.4796 9.9625 19.5006 9.85678 19.5006 9.75C19.5006 9.64322 19.4796 9.5375 19.4387 9.43886C19.3978 9.34023 19.3379 9.25062 19.2623 9.17516Z"
                                                        fill="#111111" />
                                                </svg>
                                            </div>
                                            <div class="text">Log out</div>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /section-menu-left -->
                <!-- section-content-right -->
                <div class="section-content-right">
                    <!-- header-dashboard -->
                    <div class="header-dashboard">
                        <div class="wrap">
                            <div class="header-left">
                                <a href="/dashboard">
                                    <img style="width: 50px;" id="logo_header_mobile" alt="Maxtron" src="/images/iimf/logo.png"
                                        data-light="img/logo.png" data-dark="img/logo.png">
                                </a>
                                <div class="button-show-hide">
                                    <i class="icon-chevron-left"></i>
                                </div>
                               
                            </div>
                            <div class="header-grid">
                                <div class="header-item button-dark-light">
                                    <i class="icon-moon"></i>
                                </div>

                                <div class="header-item button-zoom-maximize">
                                    <div class="">
                                        <i class="icon-maximize"></i>
                                    </div>
                                </div>
                                <div class="popup-wrap user type-header">
                                    <div class="dropdown">
                                        <button class="btn btn-secondary dropdown-toggle" type="button"
                                            id="dropdownMenuButton3" data-bs-toggle="dropdown" aria-expanded="false">
                                            <span class="header-user wg-user">
                                                <span class="image">
                                                    <img src="admin-images/avatar/user-1.png" alt="Maxtron">
                                                </span>
                                                <span class="flex flex-column">
                                                    <span class="body-text text-main-dark">IIMF</span>
                                                    <span class="text-tiny">Admin</span>
                                                </span>
                                            </span>
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-end has-content"
                                            aria-labelledby="dropdownMenuButton3">

                                            <li>
                                                <a href="#" class="user-item">
                                                    <div class="icon">
                                                        <i class="icon-headphones"></i>
                                                    </div>
                                                    <div class="body-title-2">Support</div>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="/logout" class="user-item">
                                                    <div class="icon">
                                                        <i class="icon-log-out"></i>
                                                    </div>
                                                    <div class="body-title-2">Log out</div>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /header-dashboard -->
                    <!-- main-content -->
                    <div class="main-content">
                        <!-- main-content-wrap -->
                        <!-- Gallery Management Section -->
                         <div class="main-content-inner">
                            <div class="container py-4">
                                <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3 gap-2">
                                    <h3 class="mb-2 mb-md-0">Study Abroad Management</h3>
                                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createStudyAbroadModal">
                                        <i class="fa fa-plus"></i> Add Study Abroad
                                    </button>
                                </div>
                                <div class="row g-4">
                                    <% if (studyAbroads && studyAbroads.length > 0) { %>
                                        <% studyAbroads.forEach(function(item) { %>
                                            <div class="col-12 col-md-6 col-lg-4">
                                                <div class="card h-100 shadow-sm">
                                                    <% if (item.image) { %>
                                                        <img src="<%= item.image %>" class="card-img-top" alt="Image" style="height:180px; object-fit:cover;">
                                                    <% } else { %>
                                                        <div class="card-img-top d-flex align-items-center justify-content-center bg-light" style="height:180px;">
                                                            <span class="text-muted">No Image</span>
                                                        </div>
                                                    <% } %>
                                                    <div class="card-body d-flex flex-column">
                                                        <h5 class="card-title mb-1"><%= item.title %></h5>
                                                        <h6 class="card-subtitle mb-2 text-muted"><%= item.country %></h6>
                                                        <p class="card-text" style="white-space:pre-line;"><%= item.description %></p>
                                                        <div class="mb-2">
                                                            <strong>Top Universities:</strong>
                                                            <% if (item.additionalInformation && item.additionalInformation.topUniversities && item.additionalInformation.topUniversities.length > 0) { %>
                                                                <ul class="mb-1 ps-3">
                                                                    <% item.additionalInformation.topUniversities.forEach(function(u) { %>
                                                                        <li><%= u %></li>
                                                                    <% }) %>
                                                                </ul>
                                                            <% } else { %>
                                                                <span class="text-muted">-</span>
                                                            <% } %>
                                                        </div>
                                                        <div class="mb-2">
                                                            <strong>Work Opp. (Indian Students):</strong>
                                                            <span>
                                                                <%= item.additionalInformation && item.additionalInformation.workOpportunitiesIndianStudents ? item.additionalInformation.workOpportunitiesIndianStudents : '-' %>
                                                            </span>
                                                        </div>
                                                        <div class="mb-2">
                                                            <strong>Investment:</strong>
                                                            <span>
                                                                <%= item.additionalInformation && item.additionalInformation.investment ? item.additionalInformation.investment : '-' %>
                                                            </span>
                                                        </div>
                                                        <div class="mb-2">
                                                            <strong>Why Choose:</strong>
                                                            <% if (item.whyChoose && item.whyChoose.length > 0) { %>
                                                                <ul class="mb-1 ps-3">
                                                                    <% item.whyChoose.forEach(function(w) { %>
                                                                        <li><%= w %></li>
                                                                    <% }) %>
                                                                </ul>
                                                            <% } else { %>
                                                                <span class="text-muted">-</span>
                                                            <% } %>
                                                        </div>
                                                        <div class="mb-2">
                                                            <strong>US Edu. System:</strong>
                                                            <% if (item.usEducationalSystem && item.usEducationalSystem.length > 0) { %>
                                                                <ul class="mb-1 ps-3">
                                                                    <% item.usEducationalSystem.forEach(function(u) { %>
                                                                        <li>
                                                                            <strong><%= u.title %></strong>
                                                                            <div style="font-size:0.9em;"><%= u.description %></div>
                                                                        </li>
                                                                    <% }) %>
                                                                </ul>
                                                            <% } else { %>
                                                                <span class="text-muted">-</span>
                                                            <% } %>
                                                        </div>
                                                        <div class="mb-2">
                                                            <strong>Admission Req.:</strong>
                                                            <% if (item.admissionRequirements && item.admissionRequirements.length > 0) { %>
                                                                <ul class="mb-1 ps-3">
                                                                    <% item.admissionRequirements.forEach(function(a) { %>
                                                                        <li>
                                                                            <strong><%= a.title %></strong>
                                                                            <% if (a.points && a.points.length > 0) { %>
                                                                                <ul>
                                                                                    <% a.points.forEach(function(p) { %>
                                                                                        <li><%= p %></li>
                                                                                    <% }) %>
                                                                                </ul>
                                                                            <% } %>
                                                                        </li>
                                                                    <% }) %>
                                                                </ul>
                                                            <% } else { %>
                                                                <span class="text-muted">-</span>
                                                            <% } %>
                                                        </div>
                                                        <div class="mb-2">
                                                            <strong>Top Courses:</strong>
                                                            <% if (item.topCourses && item.topCourses.length > 0) { %>
                                                                <ul class="mb-1 ps-3">
                                                                    <% item.topCourses.forEach(function(c) { %>
                                                                        <li><%= c %></li>
                                                                    <% }) %>
                                                                </ul>
                                                            <% } else { %>
                                                                <span class="text-muted">-</span>
                                                            <% } %>
                                                        </div>
                                                        <div class="mb-2">
                                                            <strong>Visa Process:</strong>
                                                            <% if (item.visaProcess && item.visaProcess.length > 0) { %>
                                                                <ul class="mb-1 ps-3">
                                                                    <% item.visaProcess.forEach(function(v) { %>
                                                                        <li>
                                                                            <strong><%= v.title %></strong>
                                                                            <div style="font-size:0.9em;"><%= v.description %></div>
                                                                        </li>
                                                                    <% }) %>
                                                                </ul>
                                                            <% } else { %>
                                                                <span class="text-muted">-</span>
                                                            <% } %>
                                                        </div>
                                                        <div class="mb-2">
                                                            <strong>Country Details:</strong>
                                                            <% if (item.countryDetails) { %>
                                                                <div>
                                                                    <strong>Capital:</strong> <%= item.countryDetails.capital || '-' %><br>
                                                                    <strong>Top Cities:</strong>
                                                                    <% if (item.countryDetails.topCities && item.countryDetails.topCities.length > 0) { %>
                                                                        <ul class="mb-1 ps-3">
                                                                            <% item.countryDetails.topCities.forEach(function(city) { %>
                                                                                <li><%= city %></li>
                                                                            <% }) %>
                                                                        </ul>
                                                                    <% } else { %>
                                                                        <span class="text-muted">-</span>
                                                                    <% } %>
                                                                    <strong>Universities:</strong>
                                                                    <% if (item.countryDetails.universities && item.countryDetails.universities.length > 0) { %>
                                                                        <ul class="mb-1 ps-3">
                                                                            <% item.countryDetails.universities.forEach(function(u) { %>
                                                                                <li><%= u %></li>
                                                                            <% }) %>
                                                                        </ul>
                                                                    <% } else { %>
                                                                        <span class="text-muted">-</span>
                                                                    <% } %>
                                                                    <strong>Indian Students:</strong> <%= item.countryDetails.indianStudents || '-' %><br>
                                                                    <strong>Currency:</strong> <%= item.countryDetails.currency || '-' %><br>
                                                                    <strong>Language:</strong> <%= item.countryDetails.language || '-' %>
                                                                </div>
                                                            <% } else { %>
                                                                <span class="text-muted">-</span>
                                                            <% } %>
                                                        </div>
                                                        <div class="mb-2">
                                                            <strong>Intake Period:</strong>
                                                            <% if (item.intakePeriod) { %>
                                                                <div>
                                                                    <strong>Fall:</strong> <%= item.intakePeriod.fallIntake || '-' %><br>
                                                                    <strong>Spring:</strong> <%= item.intakePeriod.springIntake || '-' %><br>
                                                                    <strong>Summer:</strong> <%= item.intakePeriod.summerIntake || '-' %>
                                                                </div>
                                                            <% } else { %>
                                                                <span class="text-muted">-</span>
                                                            <% } %>
                                                        </div>
                                                        <div class="mb-2">
                                                            <strong>Popular Scholarships:</strong>
                                                            <% if (item.popularScholarships && item.popularScholarships.length > 0) { %>
                                                                <ul class="mb-1 ps-3">
                                                                    <% item.popularScholarships.forEach(function(sch) { %>
                                                                        <li><%= sch %></li>
                                                                    <% }) %>
                                                                </ul>
                                                            <% } else { %>
                                                                <span class="text-muted">-</span>
                                                            <% } %>
                                                        </div>
                                                        <div class="mb-2">
                                                            <strong>Financial Req.:</strong>
                                                            <% if (item.financialRequirements) { %>
                                                                <div>
                                                                    <strong>Tuition Fees:</strong> <%= item.financialRequirements.tuitionFees || '-' %><br>
                                                                    <strong>Living Costs:</strong> <%= item.financialRequirements.livingCosts || '-' %><br>
                                                                    <strong>Total Proof Required:</strong> <%= item.financialRequirements.totalProofRequired || '-' %>
                                                                </div>
                                                            <% } else { %>
                                                                <span class="text-muted">-</span>
                                                            <% } %>
                                                        </div>
                                                        <div class="mb-2">
                                                            <strong>Work Opp.:</strong>
                                                            <% if (item.workOpportunities) { %>
                                                                <div>
                                                                    <strong>During Studies:</strong> <%= item.workOpportunities.duringStudies || '-' %><br>
                                                                    <strong>After Graduation:</strong> <%= item.workOpportunities.afterGraduation || '-' %>
                                                                </div>
                                                            <% } else { %>
                                                                <span class="text-muted">-</span>
                                                            <% } %>
                                                        </div>
                                                        <div class="mt-auto d-flex gap-2">
                                                            <button class="btn btn-sm btn-warning flex-fill" onclick="openEditModal('<%= item._id %>')" type="button">
                                                                <i class="fa fa-pencil"></i> Edit
                                                            </button>
                                                            <button class="btn btn-sm btn-danger flex-fill" onclick="deleteStudyAbroad('<%= item._id %>')" type="button">
                                                                <i class="fa fa-trash"></i> Delete
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        <% }) %>
                                    <% } else { %>
                                        <div class="col-12">
                                            <div class="alert alert-info text-center mb-0">
                                                No Study Abroad entries found.
                                            </div>
                                        </div>
                                    <% } %>
                                </div>
                            </div>
                            <!-- Create Modal -->
                       

                            <div class="modal fade" id="createStudyAbroadModal" tabindex="-1" aria-labelledby="createStudyAbroadModalLabel" aria-hidden="true">
                              <div class="modal-dialog modal-xl">
                                <div class="modal-content">
                                  <form id="createStudyAbroadForm" enctype="multipart/form-data" autocomplete="off">
                                    <div class="modal-header">
                                      <h5 class="modal-title" id="createStudyAbroadModalLabel">Add Study Abroad</h5>
                                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                      <div class="row g-3">
                                        <div class="col-md-6">
                                          <div class="form-floating-label">
                                            <input type="text" name="title" class="form-control" placeholder=" " required autocomplete="off">
                                            <label>Title</label>
                                          </div>
                                        </div>
                                        <div class="col-md-6">
                                          <div class="form-floating-label">
                                            <input type="text" name="country" class="form-control" placeholder=" " required autocomplete="off">
                                            <label>Country</label>
                                          </div>
                                        </div>
                                        <div class="col-12">
                                          <div class="form-floating-label">
                                            <textarea name="description" class="form-control" rows="2" placeholder=" "></textarea>
                                            <label>Description</label>
                                          </div>
                                        </div>
                                        <div class="col-12">
                                          <div class="form-floating-label">
                                            <input type="file" name="image" class="form-control" accept="image/*" placeholder=" ">
                                            <label>Image</label>
                                          </div>
                                        </div>
                                        <div class="col-12">
                                          <div class="form-section-title">Top Universities</div>
                                          <div id="create_topUniversities_list"></div>
                                          <div class="input-group mb-2">
                                            <input type="text" class="form-control" id="create_topUniversities_input" placeholder="Add university">
                                            <button type="button" class="btn btn-outline-primary" onclick="addToList('create_topUniversities_input','create_topUniversities_list','topUniversities')">Add</button>
                                          </div>
                                        </div>
                                        <div class="col-md-4">
                                          <div class="form-floating-label">
                                            <input type="text" name="workOpportunitiesIndianStudents" class="form-control" placeholder=" ">
                                            <label>Work Opportunities (Indian Students)</label>
                                          </div>
                                        </div>
                                        <div class="col-md-4">
                                          <div class="form-floating-label">
                                            <input type="text" name="investment" class="form-control" placeholder=" ">
                                            <label>Investment</label>
                                          </div>
                                        </div>
                                        <div class="col-12">
                                          <div class="form-section-title">Why Choose</div>
                                          <div id="create_whyChoose_list"></div>
                                          <div class="input-group mb-2">
                                            <input type="text" class="form-control" id="create_whyChoose_input" placeholder="Add reason">
                                            <button type="button" class="btn btn-outline-primary" onclick="addToList('create_whyChoose_input','create_whyChoose_list','whyChoose')">Add</button>
                                          </div>
                                        </div>
                                        <div class="col-12">
                                          <div class="form-section-title">US Educational System</div>
                                          <div id="create_usEducationalSystem_list"></div>
                                          <div class="row g-2 mb-2">
                                            <div class="col-6">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control" id="create_usEducationalSystem_title" placeholder=" ">
                                                <label>Title</label>
                                              </div>
                                            </div>
                                            <div class="col-6">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control" id="create_usEducationalSystem_description" placeholder=" ">
                                                <label>Description</label>
                                              </div>
                                            </div>
                                            <div class="col-12">
                                              <button type="button" class="btn btn-outline-primary w-100 mt-1" onclick="addToComplexList('create_usEducationalSystem_title','create_usEducationalSystem_description','create_usEducationalSystem_list','usEducationalSystem')">Add</button>
                                            </div>
                                          </div>
                                          <input type="hidden" name="usEducationalSystem" id="create_usEducationalSystem_hidden">
                                        </div>
                                        <div class="col-12">
                                          <div class="form-section-title">Admission Requirements</div>
                                          <div id="create_admissionRequirements_list"></div>
                                          <div class="row g-2 mb-2">
                                            <div class="col-6">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control" id="create_admissionRequirements_title" placeholder=" ">
                                                <label>Title</label>
                                              </div>
                                            </div>
                                            <div class="col-6">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control" id="create_admissionRequirements_point" placeholder=" ">
                                                <label>Point</label>
                                              </div>
                                            </div>
                                            <div class="col-12">
                                              <button type="button" class="btn btn-outline-primary w-100 mt-1" onclick="addAdmissionRequirement('create_admissionRequirements_title','create_admissionRequirements_point','create_admissionRequirements_list','admissionRequirements')">Add</button>
                                            </div>
                                          </div>
                                          <input type="hidden" name="admissionRequirements" id="create_admissionRequirements_hidden">
                                        </div>
                                        <div class="col-12">
                                          <div class="form-section-title">Top Courses</div>
                                          <div id="create_topCourses_list"></div>
                                          <div class="input-group mb-2">
                                            <input type="text" class="form-control" id="create_topCourses_input" placeholder="Add course">
                                            <button type="button" class="btn btn-outline-primary" onclick="addToList('create_topCourses_input','create_topCourses_list','topCourses')">Add</button>
                                          </div>
                                        </div>
                                        <div class="col-12">
                                          <div class="form-section-title">Visa Process</div>
                                          <div id="create_visaProcess_list"></div>
                                          <div class="row g-2 mb-2">
                                            <div class="col-6">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control" id="create_visaProcess_title" placeholder=" ">
                                                <label>Title</label>
                                              </div>
                                            </div>
                                            <div class="col-6">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control" id="create_visaProcess_description" placeholder=" ">
                                                <label>Description</label>
                                              </div>
                                            </div>
                                            <div class="col-12">
                                              <button type="button" class="btn btn-outline-primary w-100 mt-1" onclick="addToComplexList('create_visaProcess_title','create_visaProcess_description','create_visaProcess_list','visaProcess')">Add</button>
                                            </div>
                                          </div>
                                          <input type="hidden" name="visaProcess" id="create_visaProcess_hidden">
                                        </div>
                                        <div class="col-12">
                                          <div class="form-section-title">Country Details</div>
                                          <div class="row g-2">
                                            <div class="col-md-4">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="capital" placeholder=" ">
                                                <label>Capital</label>
                                              </div>
                                            </div>
                                            <div class="col-md-4">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="currency" placeholder=" ">
                                                <label>Currency</label>
                                              </div>
                                            </div>
                                            <div class="col-md-4">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="language" placeholder=" ">
                                                <label>Language</label>
                                              </div>
                                            </div>
                                            <div class="col-md-6">
                                              <div class="form-section-title">Top Cities</div>
                                              <div id="create_topCities_list"></div>
                                              <div class="input-group mb-2">
                                                <input type="text" class="form-control" id="create_topCities_input" placeholder="Add city">
                                                <button type="button" class="btn btn-outline-primary" onclick="addToList('create_topCities_input','create_topCities_list','topCities')">Add</button>
                                              </div>
                                            </div>
                                            <div class="col-md-6">
                                              <div class="form-section-title">Universities</div>
                                              <div id="create_countryUniversities_list"></div>
                                              <div class="input-group mb-2">
                                                <input type="text" class="form-control" id="create_countryUniversities_input" placeholder="Add university">
                                                <button type="button" class="btn btn-outline-primary" onclick="addToList('create_countryUniversities_input','create_countryUniversities_list','countryUniversities')">Add</button>
                                              </div>
                                            </div>
                                            <div class="col-12">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="indianStudents" placeholder=" ">
                                                <label>Indian Students</label>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                        <div class="col-12">
                                          <div class="form-section-title">Intake Period</div>
                                          <div class="row g-2">
                                            <div class="col-md-4">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="fallIntake" placeholder=" ">
                                                <label>Fall Intake</label>
                                              </div>
                                            </div>
                                            <div class="col-md-4">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="springIntake" placeholder=" ">
                                                <label>Spring Intake</label>
                                              </div>
                                            </div>
                                            <div class="col-md-4">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="summerIntake" placeholder=" ">
                                                <label>Summer Intake</label>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                        <div class="col-12">
                                          <div class="form-section-title">Popular Scholarships</div>
                                          <div id="create_popularScholarships_list"></div>
                                          <div class="input-group mb-2">
                                            <input type="text" class="form-control" id="create_popularScholarships_input" placeholder="Add scholarship">
                                            <button type="button" class="btn btn-outline-primary" onclick="addToList('create_popularScholarships_input','create_popularScholarships_list','popularScholarships')">Add</button>
                                          </div>
                                        </div>
                                        <div class="col-12">
                                          <div class="form-section-title">Financial Requirements</div>
                                          <div class="row g-2">
                                            <div class="col-md-4">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="tuitionFees" placeholder=" ">
                                                <label>Tuition Fees</label>
                                              </div>
                                            </div>
                                            <div class="col-md-4">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="livingCosts" placeholder=" ">
                                                <label>Living Costs</label>
                                              </div>
                                            </div>
                                            <div class="col-md-4">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="totalProofRequired" placeholder=" ">
                                                <label>Total Proof Required</label>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                        <div class="col-12">
                                          <div class="form-section-title">Work Opportunities</div>
                                          <div class="row g-2">
                                            <div class="col-md-6">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="duringStudies" placeholder=" ">
                                                <label>During Studies</label>
                                              </div>
                                            </div>
                                            <div class="col-md-6">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="afterGraduation" placeholder=" ">
                                                <label>After Graduation</label>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                    <div class="modal-footer flex-wrap">
                                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                      <button type="submit" class="btn btn-primary">Create</button>
                                    </div>
                                  </form>
                                </div>
                              </div>
                            </div>

                            <!-- Edit Modal -->
                            <div class="modal fade" id="editStudyAbroadModal" tabindex="-1" aria-labelledby="editStudyAbroadModalLabel" aria-hidden="true">
                              <div class="modal-dialog modal-xl">
                                <div class="modal-content">
                                  <form id="editStudyAbroadForm" enctype="multipart/form-data" autocomplete="off">
                                    <input type="hidden" name="id" id="edit_id">
                                    <div class="modal-header">
                                      <h5 class="modal-title" id="editStudyAbroadModalLabel">Edit Study Abroad</h5>
                                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                      <div class="row g-3">
                                        <div class="col-md-6">
                                          <div class="form-floating-label">
                                            <input type="text" name="title" id="edit_title" class="form-control" placeholder=" " required autocomplete="off">
                                            <label>Title</label>
                                          </div>
                                        </div>
                                        <div class="col-md-6">
                                          <div class="form-floating-label">
                                            <input type="text" name="country" id="edit_country" class="form-control" placeholder=" " required autocomplete="off">
                                            <label>Country</label>
                                          </div>
                                        </div>
                                        <div class="col-12">
                                          <div class="form-floating-label">
                                            <textarea name="description" id="edit_description" class="form-control" rows="2" placeholder=" "></textarea>
                                            <label>Description</label>
                                          </div>
                                        </div>
                                        <div class="col-12">
                                          <div class="form-floating-label">
                                            <input type="file" name="image" class="form-control" accept="image/*" placeholder=" ">
                                            <label>Image</label>
                                          </div>
                                          <div class="mt-2" id="edit_image_preview"></div>
                                        </div>
                                        <div class="col-12">
                                          <div class="form-section-title">Top Universities</div>
                                          <div id="edit_topUniversities_list"></div>
                                          <div class="input-group mb-2">
                                            <input type="text" class="form-control" id="edit_topUniversities_input" placeholder="Add university">
                                            <button type="button" class="btn btn-outline-primary" onclick="addToList('edit_topUniversities_input','edit_topUniversities_list','topUniversities', true)">Add</button>
                                          </div>
                                        </div>
                                        <div class="col-md-4">
                                          <div class="form-floating-label">
                                            <input type="text" name="workOpportunitiesIndianStudents" id="edit_workOpportunitiesIndianStudents" class="form-control" placeholder=" ">
                                            <label>Work Opportunities (Indian Students)</label>
                                          </div>
                                        </div>
                                        <div class="col-md-4">
                                          <div class="form-floating-label">
                                            <input type="text" name="investment" id="edit_investment" class="form-control" placeholder=" ">
                                            <label>Investment</label>
                                          </div>
                                        </div>
                                        <div class="col-12">
                                          <div class="form-section-title">Why Choose</div>
                                          <div id="edit_whyChoose_list"></div>
                                          <div class="input-group mb-2">
                                            <input type="text" class="form-control" id="edit_whyChoose_input" placeholder="Add reason">
                                            <button type="button" class="btn btn-outline-primary" onclick="addToList('edit_whyChoose_input','edit_whyChoose_list','whyChoose', true)">Add</button>
                                          </div>
                                        </div>
                                        <div class="col-12">
                                          <div class="form-section-title">US Educational System</div>
                                          <div id="edit_usEducationalSystem_list"></div>
                                          <div class="row g-2 mb-2">
                                            <div class="col-6">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control" id="edit_usEducationalSystem_title" placeholder=" ">
                                                <label>Title</label>
                                              </div>
                                            </div>
                                            <div class="col-6">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control" id="edit_usEducationalSystem_description" placeholder=" ">
                                                <label>Description</label>
                                              </div>
                                            </div>
                                            <div class="col-12">
                                              <button type="button" class="btn btn-outline-primary w-100 mt-1" onclick="addToComplexList('edit_usEducationalSystem_title','edit_usEducationalSystem_description','edit_usEducationalSystem_list','usEducationalSystem', true)">Add</button>
                                            </div>
                                          </div>
                                          <input type="hidden" name="usEducationalSystem" id="edit_usEducationalSystem_hidden">
                                        </div>
                                        <div class="col-12">
                                          <div class="form-section-title">Admission Requirements</div>
                                          <div id="edit_admissionRequirements_list"></div>
                                          <div class="row g-2 mb-2">
                                            <div class="col-6">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control" id="edit_admissionRequirements_title" placeholder=" ">
                                                <label>Title</label>
                                              </div>
                                            </div>
                                            <div class="col-6">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control" id="edit_admissionRequirements_point" placeholder=" ">
                                                <label>Point</label>
                                              </div>
                                            </div>
                                            <div class="col-12">
                                              <button type="button" class="btn btn-outline-primary w-100 mt-1" onclick="addAdmissionRequirement('edit_admissionRequirements_title','edit_admissionRequirements_point','edit_admissionRequirements_list','admissionRequirements', true)">Add</button>
                                            </div>
                                          </div>
                                          <input type="hidden" name="admissionRequirements" id="edit_admissionRequirements_hidden">
                                        </div>
                                        <div class="col-12">
                                          <div class="form-section-title">Top Courses</div>
                                          <div id="edit_topCourses_list"></div>
                                          <div class="input-group mb-2">
                                            <input type="text" class="form-control" id="edit_topCourses_input" placeholder="Add course">
                                            <button type="button" class="btn btn-outline-primary" onclick="addToList('edit_topCourses_input','edit_topCourses_list','topCourses', true)">Add</button>
                                          </div>
                                        </div>
                                        <div class="col-12">
                                          <div class="form-section-title">Visa Process</div>
                                          <div id="edit_visaProcess_list"></div>
                                          <div class="row g-2 mb-2">
                                            <div class="col-6">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control" id="edit_visaProcess_title" placeholder=" ">
                                                <label>Title</label>
                                              </div>
                                            </div>
                                            <div class="col-6">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control" id="edit_visaProcess_description" placeholder=" ">
                                                <label>Description</label>
                                              </div>
                                            </div>
                                            <div class="col-12">
                                              <button type="button" class="btn btn-outline-primary w-100 mt-1" onclick="addToComplexList('edit_visaProcess_title','edit_visaProcess_description','edit_visaProcess_list','visaProcess', true)">Add</button>
                                            </div>
                                          </div>
                                          <input type="hidden" name="visaProcess" id="edit_visaProcess_hidden">
                                        </div>
                                        <div class="col-12">
                                          <div class="form-section-title">Country Details</div>
                                          <div class="row g-2">
                                            <div class="col-md-4">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="capital" id="edit_capital" placeholder=" ">
                                                <label>Capital</label>
                                              </div>
                                            </div>
                                            <div class="col-md-4">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="currency" id="edit_currency" placeholder=" ">
                                                <label>Currency</label>
                                              </div>
                                            </div>
                                            <div class="col-md-4">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="language" id="edit_language" placeholder=" ">
                                                <label>Language</label>
                                              </div>
                                            </div>
                                            <div class="col-md-6">
                                              <div class="form-section-title">Top Cities</div>
                                              <div id="edit_topCities_list"></div>
                                              <div class="input-group mb-2">
                                                <input type="text" class="form-control" id="edit_topCities_input" placeholder="Add city">
                                                <button type="button" class="btn btn-outline-primary" onclick="addToList('edit_topCities_input','edit_topCities_list','topCities', true)">Add</button>
                                              </div>
                                            </div>
                                            <div class="col-md-6">
                                              <div class="form-section-title">Universities</div>
                                              <div id="edit_countryUniversities_list"></div>
                                              <div class="input-group mb-2">
                                                <input type="text" class="form-control" id="edit_countryUniversities_input" placeholder="Add university">
                                                <button type="button" class="btn btn-outline-primary" onclick="addToList('edit_countryUniversities_input','edit_countryUniversities_list','countryUniversities', true)">Add</button>
                                              </div>
                                            </div>
                                            <div class="col-12">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="indianStudents" id="edit_indianStudents" placeholder=" ">
                                                <label>Indian Students</label>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                        <div class="col-12">
                                          <div class="form-section-title">Intake Period</div>
                                          <div class="row g-2">
                                            <div class="col-md-4">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="fallIntake" id="edit_fallIntake" placeholder=" ">
                                                <label>Fall Intake</label>
                                              </div>
                                            </div>
                                            <div class="col-md-4">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="springIntake" id="edit_springIntake" placeholder=" ">
                                                <label>Spring Intake</label>
                                              </div>
                                            </div>
                                            <div class="col-md-4">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="summerIntake" id="edit_summerIntake" placeholder=" ">
                                                <label>Summer Intake</label>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                        <div class="col-12">
                                          <div class="form-section-title">Popular Scholarships</div>
                                          <div id="edit_popularScholarships_list"></div>
                                          <div class="input-group mb-2">
                                            <input type="text" class="form-control" id="edit_popularScholarships_input" placeholder="Add scholarship">
                                            <button type="button" class="btn btn-outline-primary" onclick="addToList('edit_popularScholarships_input','edit_popularScholarships_list','popularScholarships', true)">Add</button>
                                          </div>
                                        </div>
                                        <div class="col-12">
                                          <div class="form-section-title">Financial Requirements</div>
                                          <div class="row g-2">
                                            <div class="col-md-4">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="tuitionFees" id="edit_tuitionFees" placeholder=" ">
                                                <label>Tuition Fees</label>
                                              </div>
                                            </div>
                                            <div class="col-md-4">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="livingCosts" id="edit_livingCosts" placeholder=" ">
                                                <label>Living Costs</label>
                                              </div>
                                            </div>
                                            <div class="col-md-4">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="totalProofRequired" id="edit_totalProofRequired" placeholder=" ">
                                                <label>Total Proof Required</label>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                        <div class="col-12">
                                          <div class="form-section-title">Work Opportunities</div>
                                          <div class="row g-2">
                                            <div class="col-md-6">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="duringStudies" id="edit_duringStudies" placeholder=" ">
                                                <label>During Studies</label>
                                              </div>
                                            </div>
                                            <div class="col-md-6">
                                              <div class="form-floating-label">
                                                <input type="text" class="form-control mb-2" name="afterGraduation" id="edit_afterGraduation" placeholder=" ">
                                                <label>After Graduation</label>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                    <div class="modal-footer flex-wrap">
                                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                      <button type="submit" class="btn btn-primary">Save Changes</button>
                                    </div>
                                  </form>
                                </div>
                              </div>
                            </div>

                            <script>
    // --- Helper functions for dynamic points/array fields ---
    function addToList(inputId, listId, field, isEdit = false) {
        const input = document.getElementById(inputId);
        const list = document.getElementById(listId);
        if (!input.value.trim()) return;
        const value = input.value.trim();
        const item = document.createElement('div');
        item.className = "d-flex align-items-center mb-1";
        item.innerHTML = `<span class="flex-grow-1">${value}</span>
            <button type="button" class="btn btn-sm btn-danger ms-2" onclick="this.parentNode.remove(); updateHiddenField('${listId}','${field}',${isEdit})"><i class="fa fa-times"></i></button>`;
        list.appendChild(item);
        input.value = '';
        updateHiddenField(listId, field, isEdit);
    }

    function addToComplexList(titleId, descId, listId, field, isEdit = false) {
        const title = document.getElementById(titleId).value.trim();
        const desc = document.getElementById(descId).value.trim();
        if (!title && !desc) return;
        const list = document.getElementById(listId);
        const item = document.createElement('div');
        item.className = "d-flex align-items-center mb-1";
        item.innerHTML = `<span class="flex-grow-1"><strong>${title}</strong> <span style="font-size:0.9em;">${desc}</span></span>
            <button type="button" class="btn btn-sm btn-danger ms-2" onclick="this.parentNode.remove(); updateComplexHiddenField('${listId}','${field}',${isEdit})"><i class="fa fa-times"></i></button>`;
        item.dataset.title = title;
        item.dataset.description = desc;
        list.appendChild(item);
        document.getElementById(titleId).value = '';
        document.getElementById(descId).value = '';
        updateComplexHiddenField(listId, field, isEdit);
    }

    function addAdmissionRequirement(titleId, pointId, listId, field, isEdit = false) {
        const title = document.getElementById(titleId).value.trim();
        const point = document.getElementById(pointId).value.trim();
        if (!title && !point) return;
        
        const list = document.getElementById(listId);
        let found = null;
        Array.from(list.children).forEach(function(child) {
            if (child.dataset.title === title) found = child;
        });
        
        if (found) {
            const pointsList = found.querySelector('ul');
            if (point) {
                const li = document.createElement('li');
                li.innerHTML = `${point} <button type="button" class="btn btn-xs btn-danger ms-1 py-0 px-1" style="font-size:0.8em;" onclick="this.parentNode.remove(); updateAdmissionRequirements('${listId}','${field}',${isEdit})"><i class="fa fa-times"></i></button>`;
                pointsList.appendChild(li);
            }
        } else {
            const item = document.createElement('div');
            item.className = "mb-1";
            item.dataset.title = title;
            item.innerHTML = `<strong>${title}</strong>
                <ul class="mb-1"></ul>
                <button type="button" class="btn btn-xs btn-danger py-0 px-1" style="font-size:0.8em;" onclick="this.parentNode.remove(); updateAdmissionRequirements('${listId}','${field}',${isEdit})"><i class="fa fa-times"></i> Remove All</button>`;
            if (point) {
                const li = document.createElement('li');
                li.innerHTML = `${point} <button type="button" class="btn btn-xs btn-danger ms-1 py-0 px-1" style="font-size:0.8em;" onclick="this.parentNode.remove(); updateAdmissionRequirements('${listId}','${field}',${isEdit})"><i class="fa fa-times"></i></button>`;
                item.querySelector('ul').appendChild(li);
            }
            list.appendChild(item);
        }
        document.getElementById(titleId).value = '';
        document.getElementById(pointId).value = '';
        updateAdmissionRequirements(listId, field, isEdit);
    }

    function updateHiddenField(listId, field, isEdit) {
        const list = document.getElementById(listId);
        const arr = Array.from(list.children).map(child => {
            const span = child.querySelector('span');
            return span ? span.innerText.trim() : '';
        }).filter(text => text !== '');
        
        const form = isEdit ? document.getElementById('editStudyAbroadForm') : document.getElementById('createStudyAbroadForm');
        let hidden = form.querySelector(`input[name="${field}"]`);
        if (!hidden) {
            hidden = document.createElement('input');
            hidden.type = 'hidden';
            hidden.name = field;
            form.appendChild(hidden);
        }
        hidden.value = JSON.stringify(arr);
    }

    function updateComplexHiddenField(listId, field, isEdit) {
        const list = document.getElementById(listId);
        const arr = Array.from(list.children).map(child => ({
            title: child.dataset.title || '',
            description: child.dataset.description || ''
        })).filter(item => item.title || item.description);
        
        const form = isEdit ? document.getElementById('editStudyAbroadForm') : document.getElementById('createStudyAbroadForm');
        let hidden = form.querySelector(`input[name="${field}"]`);
        if (!hidden) {
            hidden = document.createElement('input');
            hidden.type = 'hidden';
            hidden.name = field;
            form.appendChild(hidden);
        }
        hidden.value = JSON.stringify(arr); // Store as stringified array
    }

    function updateAdmissionRequirements(listId, field, isEdit) {
        const list = document.getElementById(listId);
        const arr = Array.from(list.children).map(child => ({
            title: child.dataset.title || '',
            points: Array.from(child.querySelectorAll('ul li')).map(li => li.childNodes[0].textContent.trim())
        })).filter(item => item.title || item.points.length > 0);
        
        const form = isEdit ? document.getElementById('editStudyAbroadForm') : document.getElementById('createStudyAbroadForm');
        let hidden = form.querySelector(`input[name="${field}"]`);
        if (!hidden) {
            hidden = document.createElement('input');
            hidden.type = 'hidden';
            hidden.name = field;
            form.appendChild(hidden);
        }
        hidden.value = JSON.stringify(arr); // Store as stringified array
    }

    // --- CREATE FORM SUBMIT ---
    document.getElementById('createStudyAbroadForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const form = e.target;
        const formData = new FormData(form);

        // Helper to get array/object from hidden field (stringified)
        const getHiddenFieldValue = (fieldName) => {
            const hiddenInput = form.querySelector(`input[name="${fieldName}"]`);
            if (!hiddenInput) return [];
            try {
                return JSON.parse(hiddenInput.value);
            } catch {
                return [];
            }
        };

        // Add basic fields
        formData.set('title', form.title.value);
        formData.set('country', form.country.value);
        formData.set('description', form.description.value);

        // Set all the simple array fields
        formData.set('whyChoose', JSON.stringify(getHiddenFieldValue('whyChoose')));
        formData.set('topCourses', JSON.stringify(getHiddenFieldValue('topCourses')));
        formData.set('popularScholarships', JSON.stringify(getHiddenFieldValue('popularScholarships')));
        formData.set('topUniversities', JSON.stringify(getHiddenFieldValue('topUniversities')));

        // Set all the complex fields as stringified arrays/objects
        formData.set('usEducationalSystem', JSON.stringify(getHiddenFieldValue('usEducationalSystem')));
        formData.set('admissionRequirements', JSON.stringify(getHiddenFieldValue('admissionRequirements')));
        formData.set('visaProcess', JSON.stringify(getHiddenFieldValue('visaProcess')));

        // Build additionalInformation object
        const additionalInformation = {
            topUniversities: getHiddenFieldValue('topUniversities'),
            workOpportunitiesIndianStudents: form.workOpportunitiesIndianStudents.value || '',
            investment: form.investment.value || ''
        };
        formData.set('additionalInformation', JSON.stringify(additionalInformation));

        // Build countryDetails object
        const countryDetails = {
            capital: form.capital.value || '',
            currency: form.currency.value || '',
            language: form.language.value || '',
            topCities: getHiddenFieldValue('topCities'),
            universities: getHiddenFieldValue('countryUniversities'),
            indianStudents: form.indianStudents.value || ''
        };
        formData.set('countryDetails', JSON.stringify(countryDetails));

        // Build intakePeriod object
        const intakePeriod = {
            fallIntake: form.fallIntake.value || '',
            springIntake: form.springIntake.value || '',
            summerIntake: form.summerIntake.value || ''
        };
        formData.set('intakePeriod', JSON.stringify(intakePeriod));

        // Build financialRequirements object
        const financialRequirements = {
            tuitionFees: form.tuitionFees.value || '',
            livingCosts: form.livingCosts.value || '',
            totalProofRequired: form.totalProofRequired.value || ''
        };
        formData.set('financialRequirements', JSON.stringify(financialRequirements));

        // Build workOpportunities object
        const workOpportunities = {
            duringStudies: form.duringStudies.value || '',
            afterGraduation: form.afterGraduation.value || ''
        };
        formData.set('workOpportunities', JSON.stringify(workOpportunities));

        fetch('/createStudyAbroad', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (data.success) {
                alert('Study abroad entry created successfully!');
                location.reload();
            } else {
                alert('Failed to create entry: ' + (data.message || 'Unknown error'));
            }
        })
        .catch(error => {
            alert('Failed to create entry: ' + error.message);
        });
    });

    // --- EDIT MODAL FILL ---
    function openEditModal(id) {
        fetch('/getStudyAbroadById/' + id)
        .then(res => res.json())
        .then(data => {
            let s = null;
            if (data && data.entry) {
                s = data.entry;
            } else if (data && data.studyAbroad) {
                s = data.studyAbroad;
            }
            if (!s) {
                alert('Failed to fetch data');
                return;
            }
            document.getElementById('edit_id').value = s._id;
            document.getElementById('edit_title').value = s.title || '';
            document.getElementById('edit_country').value = s.country || '';
            document.getElementById('edit_description').value = s.description || '';
            // Image preview
            let imgHtml = '';
            if (s.image) {
                imgHtml = '<img src="' + s.image + '" alt="Image" style="width:80px; height:50px; object-fit:cover;">';
            }
            document.getElementById('edit_image_preview').innerHTML = imgHtml;

            // Top Universities
            const topUniversities = (s.additionalInformation && s.additionalInformation.topUniversities) || [];
            const topUniversitiesList = document.getElementById('edit_topUniversities_list');
            topUniversitiesList.innerHTML = '';
            topUniversities.forEach(function(u) {
                const item = document.createElement('div');
                item.className = "d-flex align-items-center mb-1";
                item.innerHTML = `<span class="flex-grow-1">${u}</span>
                    <button type="button" class="btn btn-sm btn-danger ms-2" onclick="this.parentNode.remove(); updateHiddenField('edit_topUniversities_list','topUniversities',true)"><i class="fa fa-times"></i></button>`;
                topUniversitiesList.appendChild(item);
            });
            updateHiddenField('edit_topUniversities_list','topUniversities',true);

            // Work Opportunities Indian Students
            document.getElementById('edit_workOpportunitiesIndianStudents').value = (s.additionalInformation && s.additionalInformation.workOpportunitiesIndianStudents) || '';
            // Investment
            document.getElementById('edit_investment').value = (s.additionalInformation && s.additionalInformation.investment) || '';
            // Why Choose
            const whyChoose = s.whyChoose || [];
            const whyChooseList = document.getElementById('edit_whyChoose_list');
            whyChooseList.innerHTML = '';
            whyChoose.forEach(function(w) {
                const item = document.createElement('div');
                item.className = "d-flex align-items-center mb-1";
                item.innerHTML = `<span class="flex-grow-1">${w}</span>
                    <button type="button" class="btn btn-sm btn-danger ms-2" onclick="this.parentNode.remove(); updateHiddenField('edit_whyChoose_list','whyChoose',true)"><i class="fa fa-times"></i></button>`;
                whyChooseList.appendChild(item);
            });
            updateHiddenField('edit_whyChoose_list','whyChoose',true);

            // US Educational System
            const usEducationalSystem = s.usEducationalSystem || [];
            const usEducationalSystemList = document.getElementById('edit_usEducationalSystem_list');
            usEducationalSystemList.innerHTML = '';
            usEducationalSystem.forEach(function(u) {
                const item = document.createElement('div');
                item.className = "d-flex align-items-center mb-1";
                item.dataset.title = u.title || '';
                item.dataset.description = u.description || '';
                item.innerHTML = `<span class="flex-grow-1"><strong>${u.title}</strong> <span style="font-size:0.9em;">${u.description}</span></span>
                    <button type="button" class="btn btn-sm btn-danger ms-2" onclick="this.parentNode.remove(); updateComplexHiddenField('edit_usEducationalSystem_list','usEducationalSystem',true)"><i class="fa fa-times"></i></button>`;
                usEducationalSystemList.appendChild(item);
            });
            updateComplexHiddenField('edit_usEducationalSystem_list','usEducationalSystem',true);

            // Admission Requirements
            const admissionRequirements = s.admissionRequirements || [];
            const admissionRequirementsList = document.getElementById('edit_admissionRequirements_list');
            admissionRequirementsList.innerHTML = '';
            admissionRequirements.forEach(function(a) {
                const item = document.createElement('div');
                item.className = "mb-1";
                item.dataset.title = a.title || '';
                item.innerHTML = `<strong>${a.title}</strong>
                    <ul class="mb-1"></ul>
                    <button type="button" class="btn btn-xs btn-danger py-0 px-1" style="font-size:0.8em;" onclick="this.parentNode.remove(); updateAdmissionRequirements('edit_admissionRequirements_list','admissionRequirements',true)"><i class="fa fa-times"></i> Remove All</button>`;
                const ul = item.querySelector('ul');
                (a.points || []).forEach(function(p) {
                    const li = document.createElement('li');
                    li.innerHTML = `${p} <button type="button" class="btn btn-xs btn-danger ms-1 py-0 px-1" style="font-size:0.8em;" onclick="this.parentNode.remove(); updateAdmissionRequirements('edit_admissionRequirements_list','admissionRequirements',true)"><i class="fa fa-times"></i></button>`;
                    ul.appendChild(li);
                });
                admissionRequirementsList.appendChild(item);
            });
            updateAdmissionRequirements('edit_admissionRequirements_list','admissionRequirements',true);

            // Top Courses
            const topCourses = s.topCourses || [];
            const topCoursesList = document.getElementById('edit_topCourses_list');
            topCoursesList.innerHTML = '';
            topCourses.forEach(function(c) {
                const item = document.createElement('div');
                item.className = "d-flex align-items-center mb-1";
                item.innerHTML = `<span class="flex-grow-1">${c}</span>
                    <button type="button" class="btn btn-sm btn-danger ms-2" onclick="this.parentNode.remove(); updateHiddenField('edit_topCourses_list','topCourses',true)"><i class="fa fa-times"></i></button>`;
                topCoursesList.appendChild(item);
            });
            updateHiddenField('edit_topCourses_list','topCourses',true);

            // Visa Process
            const visaProcess = s.visaProcess || [];
            const visaProcessList = document.getElementById('edit_visaProcess_list');
            visaProcessList.innerHTML = '';
            visaProcess.forEach(function(v) {
                const item = document.createElement('div');
                item.className = "d-flex align-items-center mb-1";
                item.dataset.title = v.title || '';
                item.dataset.description = v.description || '';
                item.innerHTML = `<span class="flex-grow-1"><strong>${v.title}</strong> <span style="font-size:0.9em;">${v.description}</span></span>
                    <button type="button" class="btn btn-sm btn-danger ms-2" onclick="this.parentNode.remove(); updateComplexHiddenField('edit_visaProcess_list','visaProcess',true)"><i class="fa fa-times"></i></button>`;
                visaProcessList.appendChild(item);
            });
            updateComplexHiddenField('edit_visaProcess_list','visaProcess',true);

            // Country Details
            document.getElementById('edit_capital').value = (s.countryDetails && s.countryDetails.capital) || '';
            document.getElementById('edit_currency').value = (s.countryDetails && s.countryDetails.currency) || '';
            document.getElementById('edit_language').value = (s.countryDetails && s.countryDetails.language) || '';
            document.getElementById('edit_indianStudents').value = (s.countryDetails && s.countryDetails.indianStudents) || '';
            // Top Cities
            const topCities = (s.countryDetails && s.countryDetails.topCities) || [];
            const topCitiesList = document.getElementById('edit_topCities_list');
            topCitiesList.innerHTML = '';
            topCities.forEach(function(city) {
                const item = document.createElement('div');
                item.className = "d-flex align-items-center mb-1";
                item.innerHTML = `<span class="flex-grow-1">${city}</span>
                    <button type="button" class="btn btn-sm btn-danger ms-2" onclick="this.parentNode.remove(); updateHiddenField('edit_topCities_list','topCities',true)"><i class="fa fa-times"></i></button>`;
                topCitiesList.appendChild(item);
            });
            updateHiddenField('edit_topCities_list','topCities',true);
            // Universities
            const countryUniversities = (s.countryDetails && s.countryDetails.universities) || [];
            const countryUniversitiesList = document.getElementById('edit_countryUniversities_list');
            countryUniversitiesList.innerHTML = '';
            countryUniversities.forEach(function(u) {
                const item = document.createElement('div');
                item.className = "d-flex align-items-center mb-1";
                item.innerHTML = `<span class="flex-grow-1">${u}</span>
                    <button type="button" class="btn btn-sm btn-danger ms-2" onclick="this.parentNode.remove(); updateHiddenField('edit_countryUniversities_list','countryUniversities',true)"><i class="fa fa-times"></i></button>`;
                countryUniversitiesList.appendChild(item);
            });
            updateHiddenField('edit_countryUniversities_list','countryUniversities',true);

            // Intake Period
            document.getElementById('edit_fallIntake').value = (s.intakePeriod && s.intakePeriod.fallIntake) || '';
            document.getElementById('edit_springIntake').value = (s.intakePeriod && s.intakePeriod.springIntake) || '';
            document.getElementById('edit_summerIntake').value = (s.intakePeriod && s.intakePeriod.summerIntake) || '';
            // Popular Scholarships
            const popularScholarships = s.popularScholarships || [];
            const popularScholarshipsList = document.getElementById('edit_popularScholarships_list');
            popularScholarshipsList.innerHTML = '';
            popularScholarships.forEach(function(sch) {
                const item = document.createElement('div');
                item.className = "d-flex align-items-center mb-1";
                item.innerHTML = `<span class="flex-grow-1">${sch}</span>
                    <button type="button" class="btn btn-sm btn-danger ms-2" onclick="this.parentNode.remove(); updateHiddenField('edit_popularScholarships_list','popularScholarships',true)"><i class="fa fa-times"></i></button>`;
                popularScholarshipsList.appendChild(item);
            });
            updateHiddenField('edit_popularScholarships_list','popularScholarships',true);

            // Financial Requirements
            document.getElementById('edit_tuitionFees').value = (s.financialRequirements && s.financialRequirements.tuitionFees) || '';
            document.getElementById('edit_livingCosts').value = (s.financialRequirements && s.financialRequirements.livingCosts) || '';
            document.getElementById('edit_totalProofRequired').value = (s.financialRequirements && s.financialRequirements.totalProofRequired) || '';
            // Work Opportunities
            document.getElementById('edit_duringStudies').value = (s.workOpportunities && s.workOpportunities.duringStudies) || '';
            document.getElementById('edit_afterGraduation').value = (s.workOpportunities && s.workOpportunities.afterGraduation) || '';

            var editModal = new bootstrap.Modal(document.getElementById('editStudyAbroadModal'));
            editModal.show();
        })
        .catch(() => alert('Failed to fetch data'));
    }

    // --- EDIT FORM SUBMIT ---
    document.getElementById('editStudyAbroadForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const form = e.target;
        const id = document.getElementById('edit_id').value;
        const formData = new FormData(form);

        // Helper to get array/object from hidden field (stringified)
        const getHiddenFieldValue = (fieldName) => {
            const hiddenInput = form.querySelector(`input[name="${fieldName}"]`);
            if (!hiddenInput) return [];
            try {
                return JSON.parse(hiddenInput.value);
            } catch {
                return [];
            }
        };

        // Additional Information
        const additionalInformation = {
            topUniversities: getHiddenFieldValue('topUniversities'),
            workOpportunitiesIndianStudents: form.edit_workOpportunitiesIndianStudents.value || '',
            investment: form.edit_investment.value || ''
        };
        formData.set('additionalInformation', JSON.stringify(additionalInformation));

        // Why Choose
        formData.set('whyChoose', JSON.stringify(getHiddenFieldValue('whyChoose')));

        // US Educational System
        formData.set('usEducationalSystem', JSON.stringify(getHiddenFieldValue('usEducationalSystem')));

        // Admission Requirements
        formData.set('admissionRequirements', JSON.stringify(getHiddenFieldValue('admissionRequirements')));

        // Top Courses
        formData.set('topCourses', JSON.stringify(getHiddenFieldValue('topCourses')));

        // Visa Process
        formData.set('visaProcess', JSON.stringify(getHiddenFieldValue('visaProcess')));

        // Country Details
        const countryDetails = {
            capital: form.edit_capital.value || '',
            currency: form.edit_currency.value || '',
            language: form.edit_language.value || '',
            topCities: getHiddenFieldValue('topCities'),
            universities: getHiddenFieldValue('countryUniversities'),
            indianStudents: form.edit_indianStudents.value || ''
        };
        formData.set('countryDetails', JSON.stringify(countryDetails));

        // Intake Period
        const intakePeriod = {
            fallIntake: form.edit_fallIntake.value || '',
            springIntake: form.edit_springIntake.value || '',
            summerIntake: form.edit_summerIntake.value || ''
        };
        formData.set('intakePeriod', JSON.stringify(intakePeriod));

        // Popular Scholarships
        formData.set('popularScholarships', JSON.stringify(getHiddenFieldValue('popularScholarships')));

        // Financial Requirements
        const financialRequirements = {
            tuitionFees: form.edit_tuitionFees.value || '',
            livingCosts: form.edit_livingCosts.value || '',
            totalProofRequired: form.edit_totalProofRequired.value || ''
        };
        formData.set('financialRequirements', JSON.stringify(financialRequirements));

        // Work Opportunities
        const workOpportunities = {
            duringStudies: form.edit_duringStudies.value || '',
            afterGraduation: form.edit_afterGraduation.value || ''
        };
        formData.set('workOpportunities', JSON.stringify(workOpportunities));

        fetch('/updateStudyAbroad/' + id, {
            method: 'PUT',
            body: formData
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                alert('Study abroad entry updated successfully!');
                location.reload();
            } else {
                alert(data.message || 'Failed to update entry');
            }
        })
        .catch(() => alert('Failed to update entry'));
    });

    // --- DELETE ---
    function deleteStudyAbroad(id) {
        if (!confirm('Are you sure you want to delete this entry?')) return;
        fetch('/deleteStudyAbroad/' + id, {
            method: 'DELETE'
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert(data.message || 'Failed to delete entry');
            }
        })
        .catch(() => alert('Failed to delete entry'));
    }
</script>
                         </div>

                        <!-- /main-content-wrap -->
                        <!-- bottom-page -->
                        <div class="bottom-page">
                            <div class="body-text">Copyright  2025 <a href="https://trivlogic.com">Trivlogic</a>.
                                Design by Trivlogic All rights reserved</div>
                        </div>
                        <!-- /bottom-page -->
                    </div>
                    <!-- /main-content -->
                </div>
                <!-- /section-content-right -->
            </div>
            <!-- /layout-wrap -->
        </div>
        <!-- /#page -->
    </div>
    <!-- /#wrapper -->
 
    <!-- Javascript -->
    <script src="admin-js/jquery.min.js"></script>
    <script src="admin-js/bootstrap.min.js"></script>
    <script src="admin-js/bootstrap-select.min.js"></script>
    <script src="admin-js/zoom.js"></script>
    <script src="admin-js/morris.min.js"></script>
    <script src="admin-js/raphael.min.js"></script>
    <script src="admin-js/apexcharts/apexcharts.js"></script>
    <script src="admin-js/apexcharts/line-chart-1.js"></script>
    <script src="admin-js/apexcharts/line-chart-2.js"></script>
    <script src="admin-js/apexcharts/line-chart-3.js"></script>
    <script src="admin-js/apexcharts/line-chart-4.js"></script>
    <script src="admin-js/apexcharts/line-chart-5.js"></script>
    <script src="admin-js/apexcharts/line-chart-6.js"></script>
    <script src="admin-js/apexcharts/line-chart-7.js"></script>
    <script src="admin-js/switcher.js"></script>
    <script defer src="admin-js/theme-settings.js"></script>
    <script src="admin-js/main.js"></script>

</body>

</html>