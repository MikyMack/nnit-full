<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!--<![endif]-->

<head>
    <!-- Basic Page Needs -->
    <meta charset="utf-8">
    <title>IIMF - Admin Dashboard</title>

    <meta name="author" content="trivlogic.com">

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- Theme Style -->
    <link rel="stylesheet" type="text/css" href="admin-css/animate.min.css">
    <link rel="stylesheet" type="text/css" href="admin-css/animation.css">
    <link rel="stylesheet" type="text/css" href="admin-css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="admin-css/bootstrap-select.min.css">
    <link rel="stylesheet" type="text/css" href="admin-css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Font -->
    <link rel="stylesheet" href="admin-font/fonts.css">

    <!-- Icon -->
    <link rel="stylesheet" href="admin-icon/style.css">

    <!-- Favicon and Touch Icons  -->
    <link rel="shortcut icon" href="/images/iimf/logo.png">
    <link rel="apple-touch-icon-precomposed" href="/images/iimf/logo.png">

</head>

<body>

    <!-- #wrapper -->
    <div id="wrapper">
        <!-- #page -->
        <div id="page" class="">
            <!-- layout-wrap -->
            <div class="layout-wrap">
            
                <!-- section-menu-left -->
                <div class="section-menu-left">
                    <div class="box-logo">
                        <a href="/dashboard" id="site-logo-inner">
                            <img style="width:60px;" id="logo_header" alt="Maxtron" src="/images/iimf/logo.png"
                                data-light="/images/iimf/logo.png" data-dark="/images/iimf/logo.png">
                        </a>
                        <div class="button-show-hide">
                            <i class="icon-chevron-left"></i>
                        </div>
                    </div>
                    <div class="section-menu-left-wrap">
                        <div class="center">
                            <div class="center-item">
                                <ul class="">
                                    <li class="menu-item active">
                                        <a href="/dashboard" class="">
                                            <div class="icon">
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                    xmlns="http://www.w3.org/2000/svg">
                                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                                        d="M12.2652 3.57566C12.1187 3.42921 11.8813 3.42921 11.7348 3.57566L5.25 10.0605V19.8748C5.25 20.0819 5.41789 20.2498 5.625 20.2498H9V16.1248C9 15.0893 9.83947 14.2498 10.875 14.2498H13.125C14.1605 14.2498 15 15.0893 15 16.1248V20.2498H18.375C18.5821 20.2498 18.75 20.0819 18.75 19.8748V10.0605L12.2652 3.57566ZM20.25 11.5605L21.2197 12.5302C21.5126 12.8231 21.9874 12.8231 22.2803 12.5302C22.5732 12.2373 22.5732 11.7624 22.2803 11.4695L13.3258 2.51499C12.5936 1.78276 11.4064 1.78276 10.6742 2.515L1.71967 11.4695C1.42678 11.7624 1.42678 12.2373 1.71967 12.5302C2.01256 12.8231 2.48744 12.8231 2.78033 12.5302L3.75 11.5605V19.8748C3.75 20.9104 4.58947 21.7498 5.625 21.7498H18.375C19.4105 21.7498 20.25 20.9104 20.25 19.8748V11.5605ZM13.5 20.2498H10.5V16.1248C10.5 15.9177 10.6679 15.7498 10.875 15.7498H13.125C13.3321 15.7498 13.5 15.9177 13.5 16.1248V20.2498Z"
                                                        fill="#111111" />
                                                </svg>
                                            </div>
                                            <div class="text">Course Management</div>
                                        </a>
                                    </li>
                                    <li class="menu-item">
                                        <a href="/admin-gallery" class="menu-item-button">
                                            <div class="icon"><i class="icon-file-plus"></i></div>
                                            <div class="text">Gallery Management</div>
                                        </a>                                   
                                    </li>
                                    <li class="menu-item">
                                        <a href="/admin-assesment" class="menu-item-button">
                                            <div class="icon"><i class="icon-layers"></i></div>
                                            <div class="text">Assesment Management</div>
                                        </a>                                   
                                    </li>
                               
                                    <li class="menu-item">
                                        <a href="/admin-events" class="menu-item-button">
                                            <div class="icon"><i class="fa fa-users"></i></div>
                                            <div class="text">Events Management</div>
                                        </a>
                                    </li>
                                    <li class="menu-item">
                                        <a href="/admin-studyAbroad" class="menu-item-button">
                                            <div class="icon"><i class="fa fa-users"></i></div>
                                            <div class="text">StudyAbroad Management</div>
                                        </a>
                                    </li>
                                    <li class="menu-item ">
                                        <a href="/admin-testimonials" class="menu-item-button">
                                            <div class="icon"><i class="fa fa-star-o"></i></div>
                                            <div class="text">Testimonials Management</div>
                                        </a>
                                    </li>
                                    <li class="menu-item">
                                        <a href="/admin-blogs" class="menu-item-button">
                                            <div class="icon"><i class="fa fa-star-o"></i></div>
                                            <div class="text">Blogs Management</div>
                                        </a>
                                       
                                    </li>
                                    <li class="menu-item">
                                        <a href="/admin-careers" class="menu-item-button">
                                            <div class="icon"><i class="fa fa-star-o"></i></div>
                                            <div class="text">Career Management</div>
                                        </a>
                                       
                                    </li>
                                    <li class="menu-item">
                                        <a href="/admin-users" class="menu-item-button">
                                            <div class="icon"><i class="fa fa-star-o"></i></div>
                                            <div class="text">User Management</div>
                                        </a>
                                       
                                    </li>
                                    <li class="menu-item">
                                        <a href="/admin-forms" class="menu-item-button">
                                            <div class="icon"><i class="fa fa-star-o"></i></div>
                                            <div class="text">Contact Submissions</div>
                                        </a>
                                       
                                    </li>
                                    <li class="menu-item">
                                        <a href="/logout" class="">
                                            <div class="icon">
                                                <svg width="24" height="22" viewBox="0 0 20 20" fill="none"
                                                    xmlns="http://www.w3.org/2000/svg">
                                                    <path
                                                        d="M8.125 18.6875C8.125 18.903 8.0394 19.1097 7.88702 19.262C7.73465 19.4144 7.52799 19.5 7.3125 19.5H1.625C1.19402 19.5 0.780698 19.3288 0.475951 19.024C0.171205 18.7193 0 18.306 0 17.875V1.625C0 1.19402 0.171205 0.780698 0.475951 0.475951C0.780698 0.171205 1.19402 0 1.625 0H7.3125C7.52799 0 7.73465 0.0856026 7.88702 0.237976C8.0394 0.390349 8.125 0.597012 8.125 0.8125C8.125 1.02799 8.0394 1.23465 7.88702 1.38702C7.73465 1.5394 7.52799 1.625 7.3125 1.625H1.625V17.875H7.3125C7.52799 17.875 7.73465 17.9606 7.88702 18.113C8.0394 18.2653 8.125 18.472 8.125 18.6875ZM19.2623 9.17516L15.1998 5.11266C15.0474 4.9602 14.8406 4.87455 14.625 4.87455C14.4094 4.87455 14.2026 4.9602 14.0502 5.11266C13.8977 5.26511 13.812 5.47189 13.812 5.6875C13.812 5.90311 13.8977 6.10989 14.0502 6.26234L16.7263 8.9375H7.3125C7.09701 8.9375 6.89035 9.0231 6.73798 9.17548C6.5856 9.32785 6.5 9.53451 6.5 9.75C6.5 9.96549 6.5856 10.1722 6.73798 10.3245C6.89035 10.4769 7.09701 10.5625 7.3125 10.5625H16.7263L14.0502 13.2377C13.8977 13.3901 13.812 13.5969 13.812 13.8125C13.812 14.0281 13.8977 14.2349 14.0502 14.3873C14.2026 14.5398 14.4094 14.6255 14.625 14.6255C14.8406 14.6255 15.0474 14.5398 15.1998 14.3873L19.2623 10.3248C19.3379 10.2494 19.3978 10.1598 19.4387 10.0611C19.4796 9.9625 19.5006 9.85678 19.5006 9.75C19.5006 9.64322 19.4796 9.5375 19.4387 9.43886C19.3978 9.34023 19.3379 9.25062 19.2623 9.17516Z"
                                                        fill="#111111" />
                                                </svg>
                                            </div>
                                            <div class="text">Log out</div>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /section-menu-left -->
                <!-- section-content-right -->
                <div class="section-content-right">
                    <!-- header-dashboard -->
                    <div class="header-dashboard">
                        <div class="wrap">
                            <div class="header-left">
                                <a href="/dashboard">
                                    <img style="width: 50px;" id="logo_header_mobile" alt="Maxtron" src="/images/iimf/logo.png"
                                        data-light="img/logo.png" data-dark="img/logo.png">
                                </a>
                                <div class="button-show-hide">
                                    <i class="icon-chevron-left"></i>
                                </div>
                               
                            </div>
                            <div class="header-grid">
                                <div class="header-item button-dark-light">
                                    <i class="icon-moon"></i>
                                </div>

                                <div class="header-item button-zoom-maximize">
                                    <div class="">
                                        <i class="icon-maximize"></i>
                                    </div>
                                </div>
                                <div class="popup-wrap user type-header">
                                    <div class="dropdown">
                                        <button class="btn btn-secondary dropdown-toggle" type="button"
                                            id="dropdownMenuButton3" data-bs-toggle="dropdown" aria-expanded="false">
                                            <span class="header-user wg-user">
                                                <span class="image">
                                                    <img src="admin-images/avatar/user-1.png" alt="Maxtron">
                                                </span>
                                                <span class="flex flex-column">
                                                    <span class="body-text text-main-dark">IIMF</span>
                                                    <span class="text-tiny">Admin</span>
                                                </span>
                                            </span>
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-end has-content"
                                            aria-labelledby="dropdownMenuButton3">

                                            <li>
                                                <a href="#" class="user-item">
                                                    <div class="icon">
                                                        <i class="icon-headphones"></i>
                                                    </div>
                                                    <div class="body-title-2">Support</div>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="/logout" class="user-item">
                                                    <div class="icon">
                                                        <i class="icon-log-out"></i>
                                                    </div>
                                                    <div class="body-title-2">Log out</div>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /header-dashboard -->
                    <!-- main-content -->
                    <div class="main-content">
                        <!-- main-content-wrap -->
                        <div class="main-content-inner">
                        <div class="container-fluid px-0">
                            <div class="row mb-4 align-items-center">
                                <div class="col-md-3 mb-2 mb-md-0">
                                    <form id="filterForm" class="d-flex gap-2">
                                        <select class="form-select" name="category" id="categoryFilter" onchange="document.getElementById('filterForm').submit()">
                                            <option value="all" <%= selectedCategory === 'all' ? 'selected' : '' %>>All Categories</option>
                                            <% categories.forEach(function(cat) { %>
                                                <option value="<%= cat %>" <%= selectedCategory === cat ? 'selected' : '' %>><%= cat %></option>
                                            <% }) %>
                                        </select>
                                        <input type="hidden" name="search" value="<%= searchQuery %>">
                                    </form>
                                </div>
                                <div class="col-md-5 mb-2 mb-md-0">
                                    <form id="searchForm" class="input-group">
                                        <input type="text" class="form-control" name="search" placeholder="Search by title..." value="<%= searchQuery %>">
                                        <input type="hidden" name="category" value="<%= selectedCategory %>">
                                        <button class="btn btn-primary" type="submit"><i class="icon-search"></i></button>
                                    </form>
                                </div>
                                <div class="col-md-4 text-end">
                                    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#createCourseModal">
                                        <i class="icon-plus"></i> Add New Course
                                    </button>
                                </div>
                            </div>

                            <div class="table-responsive">
                                <table class="table table-hover align-middle bg-white rounded shadow-sm">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Image</th>
                                            <th>Title</th>
                                            <th>Category</th>
                                            <th>Created</th>
                                            <th>Status</th>
                                            <th class="text-end">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% if (courses.length === 0) { %>
                                            <tr>
                                                <td colspan="6" class="text-center py-4 text-muted">No courses found.</td>
                                            </tr>
                                        <% } %>
                                        <% courses.forEach(function(course) { %>
                                            <tr id="course-row-<%= course._id %>">
                                                <td style="width:60px;">
                                                    <% if (course.image) { %>
                                                        <img src="<%=course.image %>" alt="Course Image" class="img-fluid rounded" style="max-width:48px; max-height:48px;">
                                                    <% } else { %>
                                                        <span class="badge bg-secondary">No Image</span>
                                                    <% } %>
                                                </td>
                                                <td>
                                                    <div class="fw-bold"><%= course.title %></div>
                                                    <div class="text-muted small"><%= course.specialization || '' %></div>
                                                </td>
                                                <td><span class="badge bg-info text-dark"><%= course.category %></span></td>
                                                <td><%= new Date(course.createdAt).toLocaleDateString() %></td>
                                                <td>
                                                    <span class="form-check form-switch d-inline-block">
                                                        <input class="form-check-input toggle-active-switch" type="checkbox" data-id="<%= course._id %>" <%= course.active !== false ? 'checked' : '' %>>
                                                    </span>
                                                    <span class="ms-1 badge <%= course.active !== false ? 'bg-success' : 'bg-danger' %>">
                                                        <%= course.active !== false ? 'Active' : 'Inactive' %>
                                                    </span>
                                                </td>
                                                <td class="text-end">
                                                    <div class="d-flex flex-column align-items-end gap-2">
                                                        <!-- Toggle Active Button in Actions -->
                                                        <span class="form-check form-switch d-inline-block align-middle" title="Toggle Active/Inactive" style="min-width: 60px; width: 60px; display: inline-flex; justify-content: center;">
                                                            <input class="form-check-input toggle-active-switch-action" type="checkbox" data-id="<%= course._id %>" <%= course.active !== false ? 'checked' : '' %> style="width: 2.5em; height: 1.5em;">
                                                        </span>
                                                        <button class="btn btn-sm btn-primary w-100" onclick="openEditModal('<%= course._id %>')">
                                                            <i class="icon-edit"></i> Edit
                                                        </button>
                                                        <button class="btn btn-sm btn-danger w-100" onclick="deleteCourse('<%= course._id %>')">
                                                            <i class="icon-trash-2"></i> Delete
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        <% }) %>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Pagination -->
                            <% if (totalPages > 1) { %>
                                <nav class="mt-3">
                                    <ul class="pagination justify-content-center">
                                        <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                                            <a class="page-link" href="?page=<%= currentPage - 1 %>&category=<%= selectedCategory %>&search=<%= searchQuery %>">&laquo;</a>
                                        </li>
                                        <% for (let i = 1; i <= totalPages; i++) { %>
                                            <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                                                <a class="page-link" href="?page=<%= i %>&category=<%= selectedCategory %>&search=<%= searchQuery %>"><%= i %></a>
                                            </li>
                                        <% } %>
                                        <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
                                            <a class="page-link" href="?page=<%= currentPage + 1 %>&category=<%= selectedCategory %>&search=<%= searchQuery %>">&raquo;</a>
                                        </li>
                                    </ul>
                                </nav>
                            <% } %>
                        </div>

                        <!-- Create Course Modal -->
                        <div class="modal fade" id="createCourseModal" tabindex="-1" aria-labelledby="createCourseModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-lg modal-dialog-centered">
                                <div class="modal-content">
                                    <form id="createCourseForm" enctype="multipart/form-data" autocomplete="off">
                                        <div class="modal-header bg-gradient-primary text-white">
                                            <h5 class="modal-title" id="createCourseModalLabel"><i class="icon-plus-circle me-2"></i>Add New Course</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <div id="createCourseAlert" class="alert d-none"></div>
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Title <span class="text-danger">*</span></label>
                                                    <input type="text" name="title" class="form-control" required>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Category <span class="text-danger">*</span></label>
                                                    <input type="text" name="category" class="form-control" required list="categoryList">
                                                    <datalist id="categoryList">
                                                        <% categories.forEach(function(cat) { %>
                                                            <option value="<%= cat %>">
                                                        <% }) %>
                                                    </datalist>
                                                </div>
                                                <div class="col-12">
                                                    <label class="form-label">Description <span class="text-danger">*</span></label>
                                                    <textarea name="description" class="form-control" rows="2" required></textarea>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Specialization</label>
                                                    <input type="text" name="specialization" class="form-control">
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Image</label>
                                                    <input type="file" name="image" accept="image/*" class="form-control">
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">PDF</label>
                                                    <input type="file" name="pdf" accept="application/pdf" class="form-control">
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">YouTube Link</label>
                                                    <input type="url" name="youtubeLink" class="form-control">
                                                </div>
                                                <!-- Core Modules -->
                                                <div class="col-12">
                                                    <label class="form-label">Core Modules</label>
                                                    <div id="coreModulesList" class="tag-input-list"></div>
                                                    <div class="input-group mb-2">
                                                        <input type="text" id="coreModulesInput" class="form-control" placeholder="Add a module and press Enter">
                                                        <button type="button" class="btn btn-outline-primary" id="addCoreModuleBtn"><i class="icon-plus"></i></button>
                                                    </div>
                                                    <input type="hidden" name="coreModules" id="coreModulesHidden">
                                                </div>
                                                <!-- Learning Outcomes -->
                                                <div class="col-12">
                                                    <label class="form-label">Learning Outcomes</label>
                                                    <div id="learningOutcomesList" class="tag-input-list"></div>
                                                    <div class="input-group mb-2">
                                                        <input type="text" id="learningOutcomesInput" class="form-control" placeholder="Add an outcome and press Enter">
                                                        <button type="button" class="btn btn-outline-primary" id="addLearningOutcomeBtn"><i class="icon-plus"></i></button>
                                                    </div>
                                                    <input type="hidden" name="learningOutcomes" id="learningOutcomesHidden">
                                                </div>
                                                <!-- Opportunities -->
                                                <div class="col-12">
                                                    <label class="form-label">Opportunities</label>
                                                    <div id="opportunitiesList" class="tag-input-list"></div>
                                                    <div class="input-group mb-2">
                                                        <input type="text" id="opportunitiesInput" class="form-control" placeholder="Add an opportunity and press Enter">
                                                        <button type="button" class="btn btn-outline-primary" id="addOpportunityBtn"><i class="icon-plus"></i></button>
                                                    </div>
                                                    <input type="hidden" name="opportunities" id="opportunitiesHidden">
                                                </div>
                                                <!-- Why Choose -->
                                                <div class="col-12">
                                                    <label class="form-label">Why Choose</label>
                                                    <div id="whyChooseList" class="tag-input-list"></div>
                                                    <div class="input-group mb-2">
                                                        <input type="text" id="whyChooseInput" class="form-control" placeholder="Add a reason and press Enter">
                                                        <button type="button" class="btn btn-outline-primary" id="addWhyChooseBtn"><i class="icon-plus"></i></button>
                                                    </div>
                                                    <input type="hidden" name="whyChoose" id="whyChooseHidden">
                                                </div>
                                                <div class="col-12">
                                                    <label class="form-label">Course Information</label>
                                                    <div class="row g-2">
                                                        <div class="col-md-4">
                                                            <input type="text" name="courseInformation[certifications]" class="form-control" placeholder="Certifications">
                                                        </div>
                                                        <div class="col-md-4">
                                                            <input type="text" name="courseInformation[curriculum]" class="form-control" placeholder="Curriculum">
                                                        </div>
                                                        <div class="col-md-2">
                                                            <input type="text" name="courseInformation[duration]" class="form-control" placeholder="Duration">
                                                        </div>
                                                        <div class="col-md-2">
                                                            <input type="text" name="courseInformation[language]" class="form-control" placeholder="Language">
                                                        </div>
                                                        <div class="col-md-2">
                                                            <input type="text" name="courseInformation[students]" class="form-control" placeholder="Students">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer bg-light">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                            <button type="submit" class="btn btn-success" id="createCourseBtn">
                                                <span class="spinner-border spinner-border-sm d-none" id="createCourseSpinner"></span>
                                                Create Course
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Edit Course Modal (dynamic content) -->
                        <div class="modal fade" id="editCourseModal" tabindex="-1" aria-labelledby="editCourseModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-lg modal-dialog-centered">
                                <div class="modal-content" id="editCourseModalContent">
                                    <!-- Content loaded by JS -->
                                </div>
                            </div>
                        </div>

                        <style>
                        .tag-input-list {
                            min-height: 38px;
                            padding: 4px 0;
                        }
                        .tag-badge {
                            display: inline-flex;
                            align-items: center;
                            background: #e3f2fd;
                            color: #1976d2;
                            border-radius: 20px;
                            padding: 4px 12px 4px 10px;
                            margin: 2px 4px 2px 0;
                            font-size: 0.95em;
                            font-weight: 500;
                            transition: background 0.2s;
                        }
                        .tag-badge .remove-tag {
                            color: #d32f2f;
                            margin-left: 8px;
                            cursor: pointer;
                            font-size: 1.1em;
                        }
                        .tag-badge:hover {
                            background: #bbdefb;
                        }
                        .modal-header.bg-gradient-primary {
                            background: linear-gradient(90deg, #1976d2 0%, #42a5f5 100%);
                            color: #fff;
                        }
                        </style>

                        <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            // Tag input logic for user-friendly point entry
                            function setupTagInput(inputId, listId, hiddenId, addBtnId) {
                                var $input = window.jQuery ? $('#' + inputId) : null;
                                var $list = window.jQuery ? $('#' + listId) : null;
                                var $hidden = window.jQuery ? $('#' + hiddenId) : null;
                                var $addBtn = addBtnId ? $('#' + addBtnId) : null;
                                var tags = [];

                                function renderTags() {
                                    $list.empty();
                                    tags.forEach(function(tag, idx) {
                                        $list.append(
                                            '<span class="tag-badge">' + tag + '<span class="remove-tag" data-idx="' + idx + '" title="Remove">&times;</span></span>'
                                        );
                                    });
                                    $hidden.val(JSON.stringify(tags));
                                }

                                if ($input && $input.length) {
                                    $input.on('keydown', function(e) {
                                        if (e.key === 'Enter' || e.key === ',') {
                                            e.preventDefault();
                                            var val = $input.val().trim();
                                            if (val && tags.indexOf(val) === -1) {
                                                tags.push(val);
                                                renderTags();
                                            }
                                            $input.val('');
                                        }
                                    });
                                }

                                if ($list && $list.length) {
                                    $list.on('click', '.remove-tag', function() {
                                        var idx = $(this).data('idx');
                                        tags.splice(idx, 1);
                                        renderTags();
                                    });
                                }

                                // Add via button (fix: use explicit button id)
                                if ($addBtn && $addBtn.length) {
                                    $addBtn.on('click', function() {
                                        var val = $input.val().trim();
                                        if (val && tags.indexOf(val) === -1) {
                                            tags.push(val);
                                            renderTags();
                                        }
                                        $input.val('');
                                    });
                                }

                                // Expose a way to set tags (for edit modal)
                                return {
                                    setTags: function(arr) {
                                        tags = Array.isArray(arr) ? arr : [];
                                        renderTags();
                                    },
                                    getTags: function() {
                                        return tags;
                                    }
                                };
                            }

                            // Setup tag inputs for create modal
                            var coreModulesTag, learningOutcomesTag, opportunitiesTag, whyChooseTag;
                            if (window.jQuery) {
                                $('.table-responsive').css('overflow-x', 'auto');

                                coreModulesTag = setupTagInput('coreModulesInput', 'coreModulesList', 'coreModulesHidden', 'addCoreModuleBtn');
                                learningOutcomesTag = setupTagInput('learningOutcomesInput', 'learningOutcomesList', 'learningOutcomesHidden', 'addLearningOutcomeBtn');
                                opportunitiesTag = setupTagInput('opportunitiesInput', 'opportunitiesList', 'opportunitiesHidden', 'addOpportunityBtn');
                                whyChooseTag = setupTagInput('whyChooseInput', 'whyChooseList', 'whyChooseHidden', 'addWhyChooseBtn');
                            }

                            // Create Course AJAX
                            if (window.jQuery) {
                                $('#createCourseForm').on('submit', function(e) {
                                    e.preventDefault();
                                    var $btn = $('#createCourseBtn');
                                    var $spinner = $('#createCourseSpinner');
                                    var $alert = $('#createCourseAlert');
                                    $btn.prop('disabled', true);
                                    $spinner.removeClass('d-none');
                                    $alert.addClass('d-none').removeClass('alert-success alert-danger').text('');

                                    // Set hidden fields with tag arrays
                                    $('#coreModulesHidden').val(JSON.stringify(coreModulesTag.getTags()));
                                    $('#learningOutcomesHidden').val(JSON.stringify(learningOutcomesTag.getTags()));
                                    $('#opportunitiesHidden').val(JSON.stringify(opportunitiesTag.getTags()));
                                    $('#whyChooseHidden').val(JSON.stringify(whyChooseTag.getTags()));

                                    var formData = new FormData(this);

                                    $.ajax({
                                        url: '/course',
                                        method: 'POST',
                                        data: formData,
                                        processData: false,
                                        contentType: false,
                                        success: function(res) {
                                            $alert.removeClass('d-none alert-danger').addClass('alert-success').text('Course created successfully!');
                                            setTimeout(function() { window.location.href = '/dashboard'; }, 1000);
                                        },
                                        error: function(xhr) {
                                            $alert.removeClass('d-none alert-success').addClass('alert-danger').text(xhr.responseJSON && xhr.responseJSON.message ? xhr.responseJSON.message : 'Error creating course');
                                        },
                                        complete: function() {
                                            $btn.prop('disabled', false);
                                            $spinner.addClass('d-none');
                                        }
                                    });
                                });
                            }

                            // Edit Course Modal
                            window.openEditModal = function(courseId) {
                                if (!window.jQuery) return;
                                $('#editCourseModalContent').html('<div class="modal-body text-center py-5"><div class="spinner-border"></div></div>');
                                $('#editCourseModal').modal('show');
                                $.get('/course/' + courseId, function(res) {
                                    var course = res.course;
                                    var modalHtml = `
                                        <form id="editCourseForm" enctype="multipart/form-data" autocomplete="off">
                                            <div class="modal-header bg-gradient-primary text-white">
                                                <h5 class="modal-title"><i class="icon-edit me-2"></i>Edit Course</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                            </div>
                                            <div class="modal-body">
                                                <div id="editCourseAlert" class="alert d-none"></div>
                                                <input type="hidden" name="id" value="${course._id}">
                                                <div class="row g-3">
                                                    <div class="col-md-6">
                                                        <label class="form-label">Title <span class="text-danger">*</span></label>
                                                        <input type="text" name="title" class="form-control" value="${course.title || ''}" required>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label">Category <span class="text-danger">*</span></label>
                                                        <input type="text" name="category" class="form-control" value="${course.category || ''}" required list="categoryList">
                                                    </div>
                                                    <div class="col-12">
                                                        <label class="form-label">Description <span class="text-danger">*</span></label>
                                                        <textarea name="description" class="form-control" rows="2" required>${course.description || ''}</textarea>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label">Specialization</label>
                                                        <input type="text" name="specialization" class="form-control" value="${course.specialization || ''}">
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label">Image</label>
                                                        <input type="file" name="image" accept="image/*" class="form-control">
                                                        ${course.image ? `<img src="/${course.image}" class="img-fluid mt-2 rounded" style="max-width:48px;max-height:48px;">` : ''}
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label">PDF</label>
                                                        <input type="file" name="pdf" accept="application/pdf" class="form-control">
                                                        ${course.pdf ? `<a href="/${course.pdf.replace(/^.*uploads[\\/]/, 'uploads/')}" target="_blank" class="d-block mt-2">View PDF</a>` : ''}
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label">YouTube Link</label>
                                                        <input type="url" name="youtubeLink" class="form-control" value="${course.youtubeLink || ''}">
                                                    </div>
                                                    <!-- Core Modules -->
                                                    <div class="col-12">
                                                        <label class="form-label">Core Modules</label>
                                                        <div id="editCoreModulesList" class="tag-input-list"></div>
                                                        <div class="input-group mb-2">
                                                            <input type="text" id="editCoreModulesInput" class="form-control" placeholder="Add a module and press Enter">
                                                            <button type="button" class="btn btn-outline-primary" id="editAddCoreModuleBtn"><i class="icon-plus"></i></button>
                                                        </div>
                                                        <input type="hidden" name="coreModules" id="editCoreModulesHidden">
                                                    </div>
                                                    <!-- Learning Outcomes -->
                                                    <div class="col-12">
                                                        <label class="form-label">Learning Outcomes</label>
                                                        <div id="editLearningOutcomesList" class="tag-input-list"></div>
                                                        <div class="input-group mb-2">
                                                            <input type="text" id="editLearningOutcomesInput" class="form-control" placeholder="Add an outcome and press Enter">
                                                            <button type="button" class="btn btn-outline-primary" id="editAddLearningOutcomeBtn"><i class="icon-plus"></i></button>
                                                        </div>
                                                        <input type="hidden" name="learningOutcomes" id="editLearningOutcomesHidden">
                                                    </div>
                                                    <!-- Opportunities -->
                                                    <div class="col-12">
                                                        <label class="form-label">Opportunities</label>
                                                        <div id="editOpportunitiesList" class="tag-input-list"></div>
                                                        <div class="input-group mb-2">
                                                            <input type="text" id="editOpportunitiesInput" class="form-control" placeholder="Add an opportunity and press Enter">
                                                            <button type="button" class="btn btn-outline-primary" id="editAddOpportunityBtn"><i class="icon-plus"></i></button>
                                                        </div>
                                                        <input type="hidden" name="opportunities" id="editOpportunitiesHidden">
                                                    </div>
                                                    <!-- Why Choose -->
                                                    <div class="col-12">
                                                        <label class="form-label">Why Choose</label>
                                                        <div id="editWhyChooseList" class="tag-input-list"></div>
                                                        <div class="input-group mb-2">
                                                            <input type="text" id="editWhyChooseInput" class="form-control" placeholder="Add a reason and press Enter">
                                                            <button type="button" class="btn btn-outline-primary" id="editAddWhyChooseBtn"><i class="icon-plus"></i></button>
                                                        </div>
                                                        <input type="hidden" name="whyChoose" id="editWhyChooseHidden">
                                                    </div>
                                                    <div class="col-12">
                                                        <label class="form-label">Course Information</label>
                                                        <div class="row g-2">
                                                            <div class="col-md-4">
                                                                <input type="text" name="courseInformation[certifications]" class="form-control" placeholder="Certifications" value="${course.courseInformation && course.courseInformation.certifications ? course.courseInformation.certifications : ''}">
                                                            </div>
                                                            <div class="col-md-4">
                                                                <input type="text" name="courseInformation[curriculum]" class="form-control" placeholder="Curriculum" value="${course.courseInformation && course.courseInformation.curriculum ? course.courseInformation.curriculum : ''}">
                                                            </div>
                                                            <div class="col-md-2">
                                                                <input type="text" name="courseInformation[duration]" class="form-control" placeholder="Duration" value="${course.courseInformation && course.courseInformation.duration ? course.courseInformation.duration : ''}">
                                                            </div>
                                                        </div>
                                                        <div class="row g-2 mt-1">
                                                            <div class="col-md-2">
                                                                <input type="text" name="courseInformation[language]" class="form-control" placeholder="Lang" value="${course.courseInformation && course.courseInformation.language ? course.courseInformation.language : ''}">
                                                            </div>
                                                            <div class="col-md-2">
                                                                <input type="text" name="courseInformation[students]" class="form-control" placeholder="Students" value="${course.courseInformation && course.courseInformation.students ? course.courseInformation.students : ''}">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="modal-footer bg-light">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                                <button type="submit" class="btn btn-primary" id="editCourseBtn">
                                                    <span class="spinner-border spinner-border-sm d-none" id="editCourseSpinner"></span>
                                                    Save Changes
                                                </button>
                                            </div>
                                        </form>
                                    `;
                                    $('#editCourseModalContent').html(modalHtml);

                                    // Setup tag inputs for edit modal (pass explicit button ids)
                                    var editCoreModulesTag = setupTagInput('editCoreModulesInput', 'editCoreModulesList', 'editCoreModulesHidden', 'editAddCoreModuleBtn');
                                    var editLearningOutcomesTag = setupTagInput('editLearningOutcomesInput', 'editLearningOutcomesList', 'editLearningOutcomesHidden', 'editAddLearningOutcomeBtn');
                                    var editOpportunitiesTag = setupTagInput('editOpportunitiesInput', 'editOpportunitiesList', 'editOpportunitiesHidden', 'editAddOpportunityBtn');
                                    var editWhyChooseTag = setupTagInput('editWhyChooseInput', 'editWhyChooseList', 'editWhyChooseHidden', 'editAddWhyChooseBtn');

                                    // Set initial tags
                                    editCoreModulesTag.setTags(course.coreModules || []);
                                    editLearningOutcomesTag.setTags(course.learningOutcomes || []);
                                    editOpportunitiesTag.setTags(course.opportunities || []);
                                    editWhyChooseTag.setTags(course.whyChoose || []);

                                    // Edit Course AJAX
                                    $('#editCourseForm').on('submit', function(e) {
                                        e.preventDefault();
                                        var $btn = $('#editCourseBtn');
                                        var $spinner = $('#editCourseSpinner');
                                        var $alert = $('#editCourseAlert');
                                        $btn.prop('disabled', true);
                                        $spinner.removeClass('d-none');
                                        $alert.addClass('d-none').removeClass('alert-success alert-danger').text('');

                                        // Set hidden fields with tag arrays
                                        $('#editCoreModulesHidden').val(JSON.stringify(editCoreModulesTag.getTags()));
                                        $('#editLearningOutcomesHidden').val(JSON.stringify(editLearningOutcomesTag.getTags()));
                                        $('#editOpportunitiesHidden').val(JSON.stringify(editOpportunitiesTag.getTags()));
                                        $('#editWhyChooseHidden').val(JSON.stringify(editWhyChooseTag.getTags()));

                                        var formData = new FormData(this);

                                        $.ajax({
                                            url: '/course/' + course._id,
                                            method: 'PUT',
                                            data: formData,
                                            processData: false,
                                            contentType: false,
                                            success: function(res) {
                                                $alert.removeClass('d-none alert-danger').addClass('alert-success').text('Course updated successfully!');
                                                setTimeout(function() { window.location.href = '/dashboard'; }, 1000);
                                            },
                                            error: function(xhr) {
                                                $alert.removeClass('d-none alert-success').addClass('alert-danger').text(xhr.responseJSON && xhr.responseJSON.message ? xhr.responseJSON.message : 'Error updating course');
                                            },
                                            complete: function() {
                                                $btn.prop('disabled', false);
                                                $spinner.addClass('d-none');
                                            }
                                        });
                                    });
                                }).fail(function() {
                                    $('#editCourseModalContent').html('<div class="modal-body text-danger">Failed to load course details.</div>');
                                });
                            };

                            // Delete Course
                            window.deleteCourse = function(courseId) {
                                if (!window.jQuery) return;
                                if (!confirm('Are you sure you want to delete this course?')) return;
                                var $row = $('#course-row-' + courseId);
                                $row.css('opacity', 0.5);
                                $.ajax({
                                    url: '/course/' + courseId,
                                    method: 'DELETE',
                                    success: function(res) {
                                        $row.fadeOut(300, function() { $(this).remove(); });
                                    },
                                    error: function(xhr) {
                                        alert(xhr.responseJSON && xhr.responseJSON.message ? xhr.responseJSON.message : 'Error deleting course');
                                        $row.css('opacity', 1);
                                    }
                                });
                            };

                            // Toggle Active
                            if (window.jQuery) {
                                // Use event delegation for both status and actions toggles
                                $('.table-responsive').on('change', '.toggle-active-switch, .toggle-active-switch-action', function() {
                                    var $this = $(this);
                                    var courseId = $this.data('id');
                                    // Find all toggles for this course and sync their checked state
                                    var checked = $this.prop('checked');
                                    $('.toggle-active-switch[data-id="' + courseId + '"], .toggle-active-switch-action[data-id="' + courseId + '"]').prop('checked', checked).prop('disabled', true);

                                    $.ajax({
                                        url: '/course/' + courseId + '/toggle-active',
                                        method: 'PATCH',
                                        success: function(res) {
                                            // Optionally update status badge in the status column
                                            var $row = $('#course-row-' + courseId);
                                            var $badge = $row.find('td:nth-child(5) .badge');
                                            if (checked) {
                                                $badge.removeClass('bg-danger').addClass('bg-success').text('Active');
                                            } else {
                                                $badge.removeClass('bg-success').addClass('bg-danger').text('Inactive');
                                            }
                                            // Re-enable toggles
                                            $('.toggle-active-switch[data-id="' + courseId + '"], .toggle-active-switch-action[data-id="' + courseId + '"]').prop('disabled', false);
                                        },
                                        error: function(xhr) {
                                            alert(xhr.responseJSON && xhr.responseJSON.message ? xhr.responseJSON.message : 'Error toggling status');
                                            // Revert toggle state
                                            $('.toggle-active-switch[data-id="' + courseId + '"], .toggle-active-switch-action[data-id="' + courseId + '"]').prop('checked', !checked).prop('disabled', false);
                                        }
                                    });
                                });
                            }

                            // Modal reset on close
                            if (window.jQuery) {
                                $('#createCourseModal').on('hidden.bs.modal', function() {
                                    $('#createCourseForm')[0].reset();
                                    $('#createCourseAlert').addClass('d-none').removeClass('alert-success alert-danger').text('');
                                    // Clear tag inputs
                                    if (coreModulesTag) coreModulesTag.setTags([]);
                                    if (learningOutcomesTag) learningOutcomesTag.setTags([]);
                                    if (opportunitiesTag) opportunitiesTag.setTags([]);
                                    if (whyChooseTag) whyChooseTag.setTags([]);
                                });
                                $('#editCourseModal').on('hidden.bs.modal', function() {
                                    $('#editCourseModalContent').html('');
                                });
                            }
                        }); // end DOMContentLoaded
                        </script>
                        </div>
                        <!-- /main-content-wrap -->
                        <!-- bottom-page -->
                        <div class="bottom-page">
                            <div class="body-text">Copyright  2025 <a href="https://trivlogic.com">Trivlogic</a>.
                                Design by Trivlogic All rights reserved</div>
                        </div>
                        <!-- /bottom-page -->
                    </div>
                    <!-- /main-content -->
                </div>
                <!-- /section-content-right -->
            </div>
            <!-- /layout-wrap -->
        </div>
        <!-- /#page -->
    </div>
    <!-- /#wrapper -->
 
    <!-- Javascript -->
    <script src="admin-js/jquery.min.js"></script>
    <script src="admin-js/bootstrap.min.js"></script>
    <script src="admin-js/bootstrap-select.min.js"></script>
    <script src="admin-js/zoom.js"></script>
    <script src="admin-js/morris.min.js"></script>
    <script src="admin-js/raphael.min.js"></script>
    <script src="admin-js/apexcharts/apexcharts.js"></script>
    <script src="admin-js/apexcharts/line-chart-1.js"></script>
    <script src="admin-js/apexcharts/line-chart-2.js"></script>
    <script src="admin-js/apexcharts/line-chart-3.js"></script>
    <script src="admin-js/apexcharts/line-chart-4.js"></script>
    <script src="admin-js/apexcharts/line-chart-5.js"></script>
    <script src="admin-js/apexcharts/line-chart-6.js"></script>
    <script src="admin-js/apexcharts/line-chart-7.js"></script>
    <script src="admin-js/switcher.js"></script>
    <script defer src="admin-js/theme-settings.js"></script>
    <script src="admin-js/main.js"></script>

</body>

</html>